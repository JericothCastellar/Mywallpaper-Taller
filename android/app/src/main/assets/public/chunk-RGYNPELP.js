import{b as H2,c as _2,f as X4,g as b2}from"./chunk-QT3JM55V.js";import{$ as z2,B as p2,N as u2,R as S0,T as m2,U as x2,Y as f2,Z as M2,_ as k2,aa as y2,b as n2,ba as B2,d as K,e as G,f as B0,fa as L2,g as U,h as L1,i as l2,ia as A2,j as L0,ja as C2,k as j,l as O,m as T,ma as S2,n as F,o as A0,p as J,q as A1,r as r2,s as c2,t as h2,u as v2,v as C0,w as g2,x as w2,y as d2}from"./chunk-UEAWK4NI.js";import"./chunk-O2HV3TP5.js";import"./chunk-GLN4K2RZ.js";import"./chunk-GATH6GKJ.js";import"./chunk-57UGKZLR.js";import"./chunk-VGFUWHMS.js";import"./chunk-LGEUKOOL.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-LRFGNCHE.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{f as X,h as J4,i as Q4,k as v}from"./chunk-DOEZFXYJ.js";var V0=X(b0=>{"use strict";Object.defineProperty(b0,"__esModule",{value:!0});var _0=class extends Error{constructor(o){super(o.message),this.name="PostgrestError",this.details=o.details,this.hint=o.hint,this.code=o.code}};b0.default=_0});var O0=X(b1=>{"use strict";var I2=b1&&b1.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(b1,"__esModule",{value:!0});var Z4=I2((b2(),Q4(X4))),t3=I2(V0()),j0=class{constructor(o){var t,s;this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=new Headers(o.headers),this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=(t=o.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=o.signal,this.isMaybeSingle=(s=o.isMaybeSingle)!==null&&s!==void 0?s:!1,o.fetch?this.fetch=o.fetch:typeof fetch>"u"?this.fetch=Z4.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,t){return this.headers=new Headers(this.headers),this.headers.set(o,t),this}then(o,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");let s=this.fetch,i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(e=>v(this,null,function*(){var n,l,r,c;let h=null,g=null,d=null,w=e.status,m=e.statusText;if(e.ok){if(this.method!=="HEAD"){let B=yield e.text();B===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((n=this.headers.get("Accept"))===null||n===void 0)&&n.includes("application/vnd.pgrst.plan+text"))?g=B:g=JSON.parse(B))}let f=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),k=(r=e.headers.get("content-range"))===null||r===void 0?void 0:r.split("/");f&&k&&k.length>1&&(d=parseInt(k[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(h={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,d=null,w=406,m="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{let f=yield e.text();try{h=JSON.parse(f),Array.isArray(h)&&e.status===404&&(g=[],h=null,w=200,m="OK")}catch{e.status===404&&f===""?(w=204,m="No Content"):h={message:f}}if(h&&this.isMaybeSingle&&(!((c=h?.details)===null||c===void 0)&&c.includes("0 rows"))&&(h=null,w=200,m="OK"),h&&this.shouldThrowOnError)throw new t3.default(h)}return{error:h,data:g,count:d,status:w,statusText:m}}));return this.shouldThrowOnError||(i=i.catch(e=>{var n,l,r;return{error:{message:`${(n=e?.name)!==null&&n!==void 0?n:"FetchError"}: ${e?.message}`,details:`${(l=e?.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(r=e?.code)!==null&&r!==void 0?r:""}`},data:null,count:null,status:0,statusText:""}})),i.then(o,t)}returns(){return this}overrideTypes(){return this}};b1.default=j0});var E0=X(V1=>{"use strict";var o3=V1&&V1.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(V1,"__esModule",{value:!0});var s3=o3(O0()),T0=class extends s3.default{select(o){let t=!1,s=(o??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(o,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:e=i}={}){let n=e?`${e}.order`:"order",l=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${l?`${l},`:""}${o}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:t,referencedTable:s=t}={}){let i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${o}`),this}range(o,t,{foreignTable:s,referencedTable:i=s}={}){let e=typeof i>"u"?"offset":`${i}.offset`,n=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(e,`${o}`),this.url.searchParams.set(n,`${t-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:o=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:e=!1,format:n="text"}={}){var l;let r=[o?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,e?"wal":null].filter(Boolean).join("|"),c=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${n}; for="${c}"; options=${r};`),n==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(o){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${o}`),this}};V1.default=T0});var t0=X(j1=>{"use strict";var i3=j1&&j1.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(j1,"__esModule",{value:!0});var a3=i3(E0()),P0=class extends a3.default{eq(o,t){return this.url.searchParams.append(o,`eq.${t}`),this}neq(o,t){return this.url.searchParams.append(o,`neq.${t}`),this}gt(o,t){return this.url.searchParams.append(o,`gt.${t}`),this}gte(o,t){return this.url.searchParams.append(o,`gte.${t}`),this}lt(o,t){return this.url.searchParams.append(o,`lt.${t}`),this}lte(o,t){return this.url.searchParams.append(o,`lte.${t}`),this}like(o,t){return this.url.searchParams.append(o,`like.${t}`),this}likeAllOf(o,t){return this.url.searchParams.append(o,`like(all).{${t.join(",")}}`),this}likeAnyOf(o,t){return this.url.searchParams.append(o,`like(any).{${t.join(",")}}`),this}ilike(o,t){return this.url.searchParams.append(o,`ilike.${t}`),this}ilikeAllOf(o,t){return this.url.searchParams.append(o,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(o,t){return this.url.searchParams.append(o,`ilike(any).{${t.join(",")}}`),this}is(o,t){return this.url.searchParams.append(o,`is.${t}`),this}in(o,t){let s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(o,`in.(${s})`),this}contains(o,t){return typeof t=="string"?this.url.searchParams.append(o,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(o,`cs.{${t.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(t)}`),this}containedBy(o,t){return typeof t=="string"?this.url.searchParams.append(o,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(o,`cd.{${t.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(t)}`),this}rangeGt(o,t){return this.url.searchParams.append(o,`sr.${t}`),this}rangeGte(o,t){return this.url.searchParams.append(o,`nxl.${t}`),this}rangeLt(o,t){return this.url.searchParams.append(o,`sl.${t}`),this}rangeLte(o,t){return this.url.searchParams.append(o,`nxr.${t}`),this}rangeAdjacent(o,t){return this.url.searchParams.append(o,`adj.${t}`),this}overlaps(o,t){return typeof t=="string"?this.url.searchParams.append(o,`ov.${t}`):this.url.searchParams.append(o,`ov.{${t.join(",")}}`),this}textSearch(o,t,{config:s,type:i}={}){let e="";i==="plain"?e="pl":i==="phrase"?e="ph":i==="websearch"&&(e="w");let n=s===void 0?"":`(${s})`;return this.url.searchParams.append(o,`${e}fts${n}.${t}`),this}match(o){return Object.entries(o).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(o,t,s){return this.url.searchParams.append(o,`not.${t}.${s}`),this}or(o,{foreignTable:t,referencedTable:s=t}={}){let i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${o})`),this}filter(o,t,s){return this.url.searchParams.append(o,`${t}.${s}`),this}};j1.default=P0});var I0=X(T1=>{"use strict";var e3=T1&&T1.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(T1,"__esModule",{value:!0});var O1=e3(t0()),R0=class{constructor(o,{headers:t={},schema:s,fetch:i}){this.url=o,this.headers=new Headers(t),this.schema=s,this.fetch=i}select(o,{head:t=!1,count:s}={}){let i=t?"HEAD":"GET",e=!1,n=(o??"*").split("").map(l=>/\s/.test(l)&&!e?"":(l==='"'&&(e=!e),l)).join("");return this.url.searchParams.set("select",n),s&&this.headers.append("Prefer",`count=${s}`),new O1.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(o,{count:t,defaultToNull:s=!0}={}){var i;let e="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(o)){let n=o.reduce((l,r)=>l.concat(Object.keys(r)),[]);if(n.length>0){let l=[...new Set(n)].map(r=>`"${r}"`);this.url.searchParams.set("columns",l.join(","))}}return new O1.default({method:e,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(o,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:e=!0}={}){var n;let l="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),i&&this.headers.append("Prefer",`count=${i}`),e||this.headers.append("Prefer","missing=default"),Array.isArray(o)){let r=o.reduce((c,h)=>c.concat(Object.keys(h)),[]);if(r.length>0){let c=[...new Set(r)].map(h=>`"${h}"`);this.url.searchParams.set("columns",c.join(","))}}return new O1.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}update(o,{count:t}={}){var s;let i="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new O1.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:o}={}){var t;let s="DELETE";return o&&this.headers.append("Prefer",`count=${o}`),new O1.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};T1.default=R0});var q2=X(E1=>{"use strict";var U2=E1&&E1.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(E1,"__esModule",{value:!0});var n3=U2(I0()),l3=U2(t0()),U0=class a{constructor(o,{headers:t={},schema:s,fetch:i}={}){this.url=o,this.headers=new Headers(t),this.schemaName=s,this.fetch=i}from(o){let t=new URL(`${this.url}/${o}`);return new n3.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new a(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,t={},{head:s=!1,get:i=!1,count:e}={}){var n;let l,r=new URL(`${this.url}/rpc/${o}`),c;s||i?(l=s?"HEAD":"GET",Object.entries(t).filter(([g,d])=>d!==void 0).map(([g,d])=>[g,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([g,d])=>{r.searchParams.append(g,d)})):(l="POST",c=t);let h=new Headers(this.headers);return e&&h.set("Prefer",`count=${e}`),new l3.default({method:l,url:r,headers:h,schema:this.schemaName,body:c,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}};E1.default=U0});var G2=X(H=>{"use strict";var d1=H&&H.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(H,"__esModule",{value:!0});H.PostgrestError=H.PostgrestBuilder=H.PostgrestTransformBuilder=H.PostgrestFilterBuilder=H.PostgrestQueryBuilder=H.PostgrestClient=void 0;var $2=d1(q2());H.PostgrestClient=$2.default;var D2=d1(I0());H.PostgrestQueryBuilder=D2.default;var F2=d1(t0());H.PostgrestFilterBuilder=F2.default;var N2=d1(E0());H.PostgrestTransformBuilder=N2.default;var W2=d1(O0());H.PostgrestBuilder=W2.default;var K2=d1(V0());H.PostgrestError=K2.default;H.default={PostgrestClient:$2.default,PostgrestQueryBuilder:D2.default,PostgrestFilterBuilder:F2.default,PostgrestTransformBuilder:N2.default,PostgrestBuilder:W2.default,PostgrestError:K2.default}});var V2="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-linejoin='round' d='M256 112v288M400 256H112' class='ionicon-fill-none ionicon-stroke-width'/></svg>";var j2="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 00-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 000-17.47C428.89 172.28 347.8 112 255.66 112z' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><circle cx='256' cy='256' r='80' stroke-miterlimit='10' class='ionicon-fill-none ionicon-stroke-width'/></svg>";var O2="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M304 336v40a40 40 0 01-40 40H104a40 40 0 01-40-40V136a40 40 0 0140-40h152c22.09 0 48 17.91 48 40v40M368 336l80-80-80-80M176 256h256' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>";var T2="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-miterlimit='10' d='M80 160h352M80 256h352M80 352h352' class='ionicon-fill-none ionicon-stroke-width'/></svg>";var E2="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M258.9 48C141.92 46.42 46.42 141.92 48 258.9c1.56 112.19 92.91 203.54 205.1 205.1 117 1.6 212.48-93.9 210.88-210.88C462.44 140.91 371.09 49.56 258.9 48zm126.42 327.25a4 4 0 01-6.14-.32 124.27 124.27 0 00-32.35-29.59C321.37 329 289.11 320 256 320s-65.37 9-90.83 25.34a124.24 124.24 0 00-32.35 29.58 4 4 0 01-6.14.32A175.32 175.32 0 0180 259c-1.63-97.31 78.22-178.76 175.57-179S432 158.81 432 256a175.32 175.32 0 01-46.68 119.25z'/><path d='M256 144c-19.72 0-37.55 7.39-50.22 20.82s-19 32-17.57 51.93C191.11 256 221.52 288 256 288s64.83-32 67.79-71.24c1.48-19.74-4.8-38.14-17.68-51.82C293.39 151.44 275.59 144 256 144z'/></svg>";var P2="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><path stroke-linecap='round' stroke-miterlimit='10' d='M80 112h352' class='ionicon-stroke-width'/><path d='M192 112V72h0a23.93 23.93 0 0124-24h80a23.93 23.93 0 0124 24h0v40M256 176v224M184 176l8 224M328 176l-8 224' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>";var R2=a=>{let o;return a?o=a:typeof fetch>"u"?o=(...t)=>import("./chunk-VJO5QO2U.js").then(({default:s})=>s(...t)):o=fetch,(...t)=>o(...t)};var C1=class extends Error{constructor(o,t="FunctionsError",s){super(o),this.name=t,this.context=s}},Z1=class extends C1{constructor(o){super("Failed to send a request to the Edge Function","FunctionsFetchError",o)}},S1=class extends C1{constructor(o){super("Relay Error invoking the Edge Function","FunctionsRelayError",o)}},H1=class extends C1{constructor(o){super("Edge Function returned a non-2xx status code","FunctionsHttpError",o)}},H0=(function(a){return a.Any="any",a.ApNortheast1="ap-northeast-1",a.ApNortheast2="ap-northeast-2",a.ApSouth1="ap-south-1",a.ApSoutheast1="ap-southeast-1",a.ApSoutheast2="ap-southeast-2",a.CaCentral1="ca-central-1",a.EuCentral1="eu-central-1",a.EuWest1="eu-west-1",a.EuWest2="eu-west-2",a.EuWest3="eu-west-3",a.SaEast1="sa-east-1",a.UsEast1="us-east-1",a.UsWest1="us-west-1",a.UsWest2="us-west-2",a})(H0||{});var Y4=function(a,o,t,s){function i(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(e,n){function l(h){try{c(s.next(h))}catch(g){n(g)}}function r(h){try{c(s.throw(h))}catch(g){n(g)}}function c(h){h.done?e(h.value):i(h.value).then(l,r)}c((s=s.apply(a,o||[])).next())})},_1=class{constructor(o,{headers:t={},customFetch:s,region:i=H0.Any}={}){this.url=o,this.headers=t,this.region=i,this.fetch=R2(s)}setAuth(o){this.headers.Authorization=`Bearer ${o}`}invoke(o,t={}){var s;return Y4(this,void 0,void 0,function*(){try{let{headers:i,method:e,body:n}=t,l={},{region:r}=t;r||(r=this.region);let c=new URL(`${this.url}/${o}`);r&&r!=="any"&&(l["x-region"]=r,c.searchParams.set("forceFunctionRegion",r));let h;n&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&n instanceof Blob||n instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",h=n):typeof n=="string"?(l["Content-Type"]="text/plain",h=n):typeof FormData<"u"&&n instanceof FormData?h=n:(l["Content-Type"]="application/json",h=JSON.stringify(n)));let g=yield this.fetch(c.toString(),{method:e||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),i),body:h}).catch(x=>{throw new Z1(x)}),d=g.headers.get("x-relay-error");if(d&&d==="true")throw new S1(g);if(!g.ok)throw new H1(g);let w=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),m;return w==="application/json"?m=yield g.json():w==="application/octet-stream"?m=yield g.blob():w==="text/event-stream"?m=g:w==="multipart/form-data"?m=yield g.formData():m=yield g.text(),{data:m,error:null,response:g}}catch(i){return{data:null,error:i,response:i instanceof H1||i instanceof S1?i.context:void 0}}})}};var J2=J4(G2(),1),{PostgrestClient:Q2,PostgrestQueryBuilder:f6,PostgrestFilterBuilder:M6,PostgrestTransformBuilder:k6,PostgrestBuilder:z6,PostgrestError:r3}=J2.default;var q0=class{static detectEnvironment(){var o;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((o=navigator.userAgent)===null||o===void 0)&&o.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){let t=process.versions;if(t&&t.node){let s=t.node,i=parseInt(s.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let o=this.detectEnvironment();if(o.constructor)return o.constructor;let t=o.error||"WebSocket not supported in this environment.";throw o.workaround&&(t+=`

Suggested solution: ${o.workaround}`),new Error(t)}static createWebSocket(o,t){let s=this.getWebSocketConstructor();return new s(o,t)}static isWebSocketSupported(){try{let o=this.detectEnvironment();return o.type==="native"||o.type==="ws"}catch{return!1}}},$0=q0;var X2="2.15.5";var Y2=`realtime-js/${X2}`,Z2="1.0.0";var P1=1e4,t4=1e3,o4=100,R1=(function(a){return a[a.connecting=0]="connecting",a[a.open=1]="open",a[a.closing=2]="closing",a[a.closed=3]="closed",a})(R1||{}),C=(function(a){return a.closed="closed",a.errored="errored",a.joined="joined",a.joining="joining",a.leaving="leaving",a})(C||{}),E=(function(a){return a.close="phx_close",a.error="phx_error",a.join="phx_join",a.reply="phx_reply",a.leave="phx_leave",a.access_token="access_token",a})(E||{}),D0=(function(a){return a.websocket="websocket",a})(D0||{}),Y=(function(a){return a.Connecting="connecting",a.Open="open",a.Closing="closing",a.Closed="closed",a})(Y||{});var o0=class{constructor(){this.HEADER_LENGTH=1}decode(o,t){return o.constructor===ArrayBuffer?t(this._binaryDecode(o)):t(typeof o=="string"?JSON.parse(o):{})}_binaryDecode(o){let t=new DataView(o),s=new TextDecoder;return this._decodeBroadcast(o,t,s)}_decodeBroadcast(o,t,s){let i=t.getUint8(1),e=t.getUint8(2),n=this.HEADER_LENGTH+2,l=s.decode(o.slice(n,n+i));n=n+i;let r=s.decode(o.slice(n,n+e));n=n+e;let c=JSON.parse(s.decode(o.slice(n,o.byteLength)));return{ref:null,topic:l,event:r,payload:c}}};var p1=class{constructor(o,t){this.callback=o,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=o,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var y=(function(a){return a.abstime="abstime",a.bool="bool",a.date="date",a.daterange="daterange",a.float4="float4",a.float8="float8",a.int2="int2",a.int4="int4",a.int4range="int4range",a.int8="int8",a.int8range="int8range",a.json="json",a.jsonb="jsonb",a.money="money",a.numeric="numeric",a.oid="oid",a.reltime="reltime",a.text="text",a.time="time",a.timestamp="timestamp",a.timestamptz="timestamptz",a.timetz="timetz",a.tsrange="tsrange",a.tstzrange="tstzrange",a})(y||{}),N0=(a,o,t={})=>{var s;let i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(o).reduce((e,n)=>(e[n]=c3(n,a,o,i),e),{})},c3=(a,o,t,s)=>{let i=o.find(l=>l.name===a),e=i?.type,n=t[a];return e&&!s.includes(e)?s4(e,n):F0(n)},s4=(a,o)=>{if(a.charAt(0)==="_"){let t=a.slice(1,a.length);return w3(o,t)}switch(a){case y.bool:return h3(o);case y.float4:case y.float8:case y.int2:case y.int4:case y.int8:case y.numeric:case y.oid:return v3(o);case y.json:case y.jsonb:return g3(o);case y.timestamp:return d3(o);case y.abstime:case y.date:case y.daterange:case y.int4range:case y.int8range:case y.money:case y.reltime:case y.text:case y.time:case y.timestamptz:case y.timetz:case y.tsrange:case y.tstzrange:return F0(o);default:return F0(o)}},F0=a=>a,h3=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},v3=a=>{if(typeof a=="string"){let o=parseFloat(a);if(!Number.isNaN(o))return o}return a},g3=a=>{if(typeof a=="string")try{return JSON.parse(a)}catch(o){return console.log(`JSON parse error: ${o}`),a}return a},w3=(a,o)=>{if(typeof a!="string")return a;let t=a.length-1,s=a[t];if(a[0]==="{"&&s==="}"){let e,n=a.slice(1,t);try{e=JSON.parse("["+n+"]")}catch{e=n?n.split(","):[]}return e.map(l=>s4(o,l))}return a},d3=a=>typeof a=="string"?a.replace(" ","T"):a,s0=a=>{let o=a;return o=o.replace(/^ws/i,"http"),o=o.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),o.replace(/\/+$/,"")+"/api/broadcast"};var u1=class{constructor(o,t,s={},i=P1){this.channel=o,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(o){this.timeout=o,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(o){this.payload=Object.assign(Object.assign({},this.payload),o)}receive(o,t){var s;return this._hasReceived(o)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:o,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let o=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},o),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(o,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:o,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:o,response:t}){this.recHooks.filter(s=>s.status===o).forEach(s=>s.callback(t))}_hasReceived(o){return this.receivedResp&&this.receivedResp.status===o}};var I1=class a{constructor(o,t){this.channel=o,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{let{onJoin:e,onLeave:n,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=a.syncState(this.state,i,e,n),this.pendingDiffs.forEach(r=>{this.state=a.syncDiff(this.state,r,e,n)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},i=>{let{onJoin:e,onLeave:n,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=a.syncDiff(this.state,i,e,n),l())}),this.onJoin((i,e,n)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:e,newPresences:n})}),this.onLeave((i,e,n)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:e,leftPresences:n})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(o,t,s,i){let e=this.cloneDeep(o),n=this.transformState(t),l={},r={};return this.map(e,(c,h)=>{n[c]||(r[c]=h)}),this.map(n,(c,h)=>{let g=e[c];if(g){let d=h.map(f=>f.presence_ref),w=g.map(f=>f.presence_ref),m=h.filter(f=>w.indexOf(f.presence_ref)<0),x=g.filter(f=>d.indexOf(f.presence_ref)<0);m.length>0&&(l[c]=m),x.length>0&&(r[c]=x)}else l[c]=h}),this.syncDiff(e,{joins:l,leaves:r},s,i)}static syncDiff(o,t,s,i){let{joins:e,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(e,(l,r)=>{var c;let h=(c=o[l])!==null&&c!==void 0?c:[];if(o[l]=this.cloneDeep(r),h.length>0){let g=o[l].map(w=>w.presence_ref),d=h.filter(w=>g.indexOf(w.presence_ref)<0);o[l].unshift(...d)}s(l,h,r)}),this.map(n,(l,r)=>{let c=o[l];if(!c)return;let h=r.map(g=>g.presence_ref);c=c.filter(g=>h.indexOf(g.presence_ref)<0),o[l]=c,i(l,c,r),c.length===0&&delete o[l]}),o}static map(o,t){return Object.getOwnPropertyNames(o).map(s=>t(s,o[s]))}static transformState(o){return o=this.cloneDeep(o),Object.getOwnPropertyNames(o).reduce((t,s)=>{let i=o[s];return"metas"in i?t[s]=i.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[s]=i,t},{})}static cloneDeep(o){return JSON.parse(JSON.stringify(o))}onJoin(o){this.caller.onJoin=o}onLeave(o){this.caller.onLeave=o}onSync(o){this.caller.onSync=o}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var U1=(function(a){return a.BROADCAST="broadcast",a.PRESENCE="presence",a.POSTGRES_CHANGES="postgres_changes",a.SYSTEM="system",a})(U1||{}),N=(function(a){return a.SUBSCRIBED="SUBSCRIBED",a.TIMED_OUT="TIMED_OUT",a.CLOSED="CLOSED",a.CHANNEL_ERROR="CHANNEL_ERROR",a})(N||{});var q1=class a{constructor(o,t={config:{}},s){this.topic=o,this.params=t,this.socket=s,this.bindings={},this.state=C.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=o.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new u1(this,E.join,this.params,this.timeout),this.rejoinTimer=new p1(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=C.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=C.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this._on(E.reply,{},(i,e)=>{this._trigger(this._replyEventName(e),i)}),this.presence=new I1(this),this.broadcastEndpointURL=s0(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(o,t=this.timeout){var s,i,e;if(this.socket.isConnected()||this.socket.connect(),this.state==C.closed){let{config:{broadcast:n,presence:l,private:r}}=this.params,c=(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(w=>w.filter))!==null&&i!==void 0?i:[],h=!!this.bindings[U1.PRESENCE]&&this.bindings[U1.PRESENCE].length>0||((e=this.params.config.presence)===null||e===void 0?void 0:e.enabled)===!0,g={},d={broadcast:n,presence:Object.assign(Object.assign({},l),{enabled:h}),postgres_changes:c,private:r};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(w=>o?.(N.CHANNEL_ERROR,w)),this._onClose(()=>o?.(N.CLOSED)),this.updateJoinPayload(Object.assign({config:d},g)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",m=>v(this,[m],function*({postgres_changes:w}){var x;if(this.socket.setAuth(),w===void 0){o?.(N.SUBSCRIBED);return}else{let f=this.bindings.postgres_changes,k=(x=f?.length)!==null&&x!==void 0?x:0,B=[];for(let S=0;S<k;S++){let p=f[S],{filter:{event:z,schema:g1,table:L,filter:b}}=p,w1=w&&w[S];if(w1&&w1.event===z&&w1.schema===g1&&w1.table===L&&w1.filter===b)B.push(Object.assign(Object.assign({},p),{id:w1.id}));else{this.unsubscribe(),this.state=C.errored,o?.(N.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=B,o&&o(N.SUBSCRIBED);return}})).receive("error",w=>{this.state=C.errored,o?.(N.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(w).join(", ")||"error")))}).receive("timeout",()=>{o?.(N.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(s){return v(this,arguments,function*(o,t={}){return yield this.send({type:"presence",event:"track",payload:o},t.timeout||this.timeout)})}untrack(){return v(this,arguments,function*(o={}){return yield this.send({type:"presence",event:"untrack"},o)})}on(o,t,s){return this.state===C.joined&&o===U1.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(o,t,s)}send(s){return v(this,arguments,function*(o,t={}){var i,e;if(!this._canPush()&&o.type==="broadcast"){let{event:n,payload:l}=o,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:l,private:this.private}]})};try{let h=yield this._fetchWithTimeout(this.broadcastEndpointURL,c,(i=t.timeout)!==null&&i!==void 0?i:this.timeout);return yield(e=h.body)===null||e===void 0?void 0:e.cancel(),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var l,r,c;let h=this._push(o.type,o,t.timeout||this.timeout);o.type==="broadcast"&&!(!((c=(r=(l=this.params)===null||l===void 0?void 0:l.config)===null||r===void 0?void 0:r.broadcast)===null||c===void 0)&&c.ack)&&n("ok"),h.receive("ok",()=>n("ok")),h.receive("error",()=>n("error")),h.receive("timeout",()=>n("timed out"))})})}updateJoinPayload(o){this.joinPush.updatePayload(o)}unsubscribe(o=this.timeout){this.state=C.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(E.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new u1(this,E.leave,{},o),s.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(o=>o.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=C.closed,this.bindings={}}_fetchWithTimeout(o,t,s){return v(this,null,function*(){let i=new AbortController,e=setTimeout(()=>i.abort(),s),n=yield this.socket.fetch(o,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(e),n})}_push(o,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${o}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new u1(this,o,t,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(o){if(o.startTimeout(),this.pushBuffer.push(o),this.pushBuffer.length>o4){let t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(o,t,s){return t}_isMember(o){return this.topic===o}_joinRef(){return this.joinPush.ref}_trigger(o,t,s){var i,e;let n=o.toLocaleLowerCase(),{close:l,error:r,leave:c,join:h}=E;if(s&&[l,r,c,h].indexOf(n)>=0&&s!==this._joinRef())return;let d=this._onMessage(n,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(w=>{var m,x,f;return((m=w.filter)===null||m===void 0?void 0:m.event)==="*"||((f=(x=w.filter)===null||x===void 0?void 0:x.event)===null||f===void 0?void 0:f.toLocaleLowerCase())===n}).map(w=>w.callback(d,s)):(e=this.bindings[n])===null||e===void 0||e.filter(w=>{var m,x,f,k,B,S;if(["broadcast","presence","postgres_changes"].includes(n))if("id"in w){let p=w.id,z=(m=w.filter)===null||m===void 0?void 0:m.event;return p&&((x=t.ids)===null||x===void 0?void 0:x.includes(p))&&(z==="*"||z?.toLocaleLowerCase()===((f=t.data)===null||f===void 0?void 0:f.type.toLocaleLowerCase()))}else{let p=(B=(k=w?.filter)===null||k===void 0?void 0:k.event)===null||B===void 0?void 0:B.toLocaleLowerCase();return p==="*"||p===((S=t?.event)===null||S===void 0?void 0:S.toLocaleLowerCase())}else return w.type.toLocaleLowerCase()===n}).map(w=>{if(typeof d=="object"&&"ids"in d){let m=d.data,{schema:x,table:f,commit_timestamp:k,type:B,errors:S}=m;d=Object.assign(Object.assign({},{schema:x,table:f,commit_timestamp:k,eventType:B,new:{},old:{},errors:S}),this._getPayloadRecords(m))}w.callback(d,s)})}_isClosed(){return this.state===C.closed}_isJoined(){return this.state===C.joined}_isJoining(){return this.state===C.joining}_isLeaving(){return this.state===C.leaving}_replyEventName(o){return`chan_reply_${o}`}_on(o,t,s){let i=o.toLocaleLowerCase(),e={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(e):this.bindings[i]=[e],this}_off(o,t){let s=o.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var e;return!(((e=i.type)===null||e===void 0?void 0:e.toLocaleLowerCase())===s&&a.isEqual(i.filter,t))})),this}static isEqual(o,t){if(Object.keys(o).length!==Object.keys(t).length)return!1;for(let s in o)if(o[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(o){this._on(E.close,{},o)}_onError(o){this._on(E.error,{},t=>o(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(o=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=C.joining,this.joinPush.resend(o))}_getPayloadRecords(o){let t={new:{},old:{}};return(o.type==="INSERT"||o.type==="UPDATE")&&(t.new=N0(o.columns,o.record)),(o.type==="UPDATE"||o.type==="DELETE")&&(t.old=N0(o.columns,o.old_record)),t}};var W0=()=>{},i0={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},u3=[1e3,2e3,5e3,1e4],m3=1e4,x3=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,$1=class{constructor(o,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=P1,this.transport=null,this.heartbeatIntervalMs=i0.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=W0,this.ref=0,this.reconnectTimer=null,this.logger=W0,this.conn=null,this.sendBuffer=[],this.serializer=new o0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...n)=>import("./chunk-VJO5QO2U.js").then(({default:l})=>l(...n)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):e=fetch,(...n)=>e(...n)},!(!((s=t?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${o}/${D0.websocket}`,this.httpEndpoint=s0(o),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=$0.createWebSocket(this.endpointURL())}catch(o){this._setConnectionState("disconnected");let t=o.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Z2}))}disconnect(o,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},o?this.conn.close(o,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(o){return v(this,null,function*(){let t=yield o.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return v(this,null,function*(){let o=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),o})}log(o,t,s){this.logger(o,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case R1.connecting:return Y.Connecting;case R1.open:return Y.Open;case R1.closing:return Y.Closing;default:return Y.Closed}}isConnected(){return this.connectionState()===Y.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(o,t={config:{}}){let s=`realtime:${o}`,i=this.getChannels().find(e=>e.topic===s);if(i)return i;{let e=new q1(`realtime:${o}`,t,this);return this.channels.push(e),e}}push(o){let{topic:t,event:s,payload:i,ref:e}=o,n=()=>{this.encode(o,l=>{var r;(r=this.conn)===null||r===void 0||r.send(l)})};this.log("push",`${t} ${s} (${e})`,i),this.isConnected()?n():this.sendBuffer.push(n)}setAuth(o=null){return v(this,null,function*(){this._authPromise=this._performAuth(o);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return v(this,null,function*(){var o;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(o=this.conn)===null||o===void 0||o.close(t4,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},i0.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")})}onHeartbeat(o){this.heartbeatCallback=o}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(o=>o()),this.sendBuffer=[])}_makeRef(){let o=this.ref+1;return o===this.ref?this.ref=0:this.ref=o,this.ref.toString()}_leaveOpenTopic(o){let t=this.channels.find(s=>s.topic===o&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${o}"`),t.unsubscribe())}_remove(o){this.channels=this.channels.filter(t=>t.topic!==o.topic)}_onConnMessage(o){this.decode(o.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:s,event:i,payload:e,ref:n}=t,l=n?`(${n})`:"",r=e.status||"";this.log("receive",`${r} ${s} ${i} ${l}`.trim(),e),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(i,e,n)),this._triggerStateCallbacks("message",t)})}_clearTimer(o){var t;o==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):o==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=o=>this._onConnError(o),this.conn.onmessage=o=>this._onConnMessage(o),this.conn.onclose=o=>this._onConnClose(o))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(o=>o.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let o=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(o),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(o){var t;this._setConnectionState("disconnected"),this.log("transport","close",o),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",o)}_onConnError(o){this._setConnectionState("disconnected"),this.log("transport",`${o}`),this._triggerChanError(),this._triggerStateCallbacks("error",o)}_triggerChanError(){this.channels.forEach(o=>o._trigger(E.error))}_appendParams(o,t){if(Object.keys(t).length===0)return o;let s=o.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${o}${s}${i}`}_workerObjectUrl(o){let t;if(o)t=o;else{let s=new Blob([x3],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(o,t=!1){this._connectionState=o,o==="connecting"?this._wasManualDisconnect=!1:o==="disconnecting"&&(this._wasManualDisconnect=t)}_performAuth(o=null){return v(this,null,function*(){let t;o?t=o:this.accessToken?t=yield this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{let i={access_token:t,version:Y2};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(E.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return v(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(o="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${o}`,t)})}_triggerStateCallbacks(o,t){try{this.stateChangeCallbacks[o].forEach(s=>{try{s(t)}catch(i){this.log("error",`error in ${o} callback`,i)}})}catch(s){this.log("error",`error triggering ${o} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new p1(()=>v(this,null,function*(){setTimeout(()=>v(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),i0.RECONNECT_DELAY)}),this.reconnectAfterMs)}_initializeOptions(o){var t,s,i,e,n,l,r,c,h;if(this.transport=(t=o?.transport)!==null&&t!==void 0?t:null,this.timeout=(s=o?.timeout)!==null&&s!==void 0?s:P1,this.heartbeatIntervalMs=(i=o?.heartbeatIntervalMs)!==null&&i!==void 0?i:i0.HEARTBEAT_INTERVAL,this.worker=(e=o?.worker)!==null&&e!==void 0?e:!1,this.accessToken=(n=o?.accessToken)!==null&&n!==void 0?n:null,this.heartbeatCallback=(l=o?.heartbeatCallback)!==null&&l!==void 0?l:W0,o?.params&&(this.params=o.params),o?.logger&&(this.logger=o.logger),(o?.logLevel||o?.log_level)&&(this.logLevel=o.logLevel||o.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(r=o?.reconnectAfterMs)!==null&&r!==void 0?r:g=>u3[g-1]||m3,this.encode=(c=o?.encode)!==null&&c!==void 0?c:(g,d)=>d(JSON.stringify(g)),this.decode=(h=o?.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=o?.workerUrl}}};var m1=class extends Error{constructor(o){super(o),this.__isStorageError=!0,this.name="StorageError"}};function A(a){return typeof a=="object"&&a!==null&&"__isStorageError"in a}var a0=class extends m1{constructor(o,t,s){super(o),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Z=class extends m1{constructor(o,t){super(o),this.name="StorageUnknownError",this.originalError=t}};var f3=function(a,o,t,s){function i(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(e,n){function l(h){try{c(s.next(h))}catch(g){n(g)}}function r(h){try{c(s.throw(h))}catch(g){n(g)}}function c(h){h.done?e(h.value):i(h.value).then(l,r)}c((s=s.apply(a,o||[])).next())})},n0=a=>{let o;return a?o=a:typeof fetch>"u"?o=(...t)=>import("./chunk-VJO5QO2U.js").then(({default:s})=>s(...t)):o=fetch,(...t)=>o(...t)},i4=()=>f3(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-VJO5QO2U.js")).Response:Response}),e0=a=>{if(Array.isArray(a))return a.map(t=>e0(t));if(typeof a=="function"||a!==Object(a))return a;let o={};return Object.entries(a).forEach(([t,s])=>{let i=t.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));o[i]=e0(s)}),o},a4=a=>{if(typeof a!="object"||a===null)return!1;let o=Object.getPrototypeOf(a);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)};var t1=function(a,o,t,s){function i(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(e,n){function l(h){try{c(s.next(h))}catch(g){n(g)}}function r(h){try{c(s.throw(h))}catch(g){n(g)}}function c(h){h.done?e(h.value):i(h.value).then(l,r)}c((s=s.apply(a,o||[])).next())})},K0=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),M3=(a,o,t)=>t1(void 0,void 0,void 0,function*(){let s=yield i4();a instanceof s&&!t?.noResolveJson?a.json().then(i=>{let e=a.status||500,n=i?.statusCode||e+"";o(new a0(K0(i),e,n))}).catch(i=>{o(new Z(K0(i),i))}):o(new Z(K0(a),a))}),k3=(a,o,t,s)=>{let i={method:a,headers:o?.headers||{}};return a==="GET"||!s?i:(a4(s)?(i.headers=Object.assign({"Content-Type":"application/json"},o?.headers),i.body=JSON.stringify(s)):i.body=s,o?.duplex&&(i.duplex=o.duplex),Object.assign(Object.assign({},i),t))};function D1(a,o,t,s,i,e){return t1(this,void 0,void 0,function*(){return new Promise((n,l)=>{a(t,k3(o,s,i,e)).then(r=>{if(!r.ok)throw r;return s?.noResolveJson?r:r.json()}).then(r=>n(r)).catch(r=>M3(r,l,s))})})}function x1(a,o,t,s){return t1(this,void 0,void 0,function*(){return D1(a,"GET",o,t,s)})}function P(a,o,t,s,i){return t1(this,void 0,void 0,function*(){return D1(a,"POST",o,s,i,t)})}function F1(a,o,t,s,i){return t1(this,void 0,void 0,function*(){return D1(a,"PUT",o,s,i,t)})}function e4(a,o,t,s){return t1(this,void 0,void 0,function*(){return D1(a,"HEAD",o,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function l0(a,o,t,s,i){return t1(this,void 0,void 0,function*(){return D1(a,"DELETE",o,s,i,t)})}var V=function(a,o,t,s){function i(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(e,n){function l(h){try{c(s.next(h))}catch(g){n(g)}}function r(h){try{c(s.throw(h))}catch(g){n(g)}}function c(h){h.done?e(h.value):i(h.value).then(l,r)}c((s=s.apply(a,o||[])).next())})},z3={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},n4={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},r0=class{constructor(o,t={},s,i){this.shouldThrowOnError=!1,this.url=o,this.headers=t,this.bucketId=s,this.fetch=n0(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(o,t,s,i){return V(this,void 0,void 0,function*(){try{let e,n=Object.assign(Object.assign({},n4),i),l=Object.assign(Object.assign({},this.headers),o==="POST"&&{"x-upsert":String(n.upsert)}),r=n.metadata;typeof Blob<"u"&&s instanceof Blob?(e=new FormData,e.append("cacheControl",n.cacheControl),r&&e.append("metadata",this.encodeMetadata(r)),e.append("",s)):typeof FormData<"u"&&s instanceof FormData?(e=s,e.append("cacheControl",n.cacheControl),r&&e.append("metadata",this.encodeMetadata(r))):(e=s,l["cache-control"]=`max-age=${n.cacheControl}`,l["content-type"]=n.contentType,r&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(r)))),i?.headers&&(l=Object.assign(Object.assign({},l),i.headers));let c=this._removeEmptyFolders(t),h=this._getFinalPath(c),g=yield(o=="PUT"?F1:P)(this.fetch,`${this.url}/object/${h}`,e,Object.assign({headers:l},n?.duplex?{duplex:n.duplex}:{}));return{data:{path:c,id:g.Id,fullPath:g.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}upload(o,t,s){return V(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",o,t,s)})}uploadToSignedUrl(o,t,s,i){return V(this,void 0,void 0,function*(){let e=this._removeEmptyFolders(o),n=this._getFinalPath(e),l=new URL(this.url+`/object/upload/sign/${n}`);l.searchParams.set("token",t);try{let r,c=Object.assign({upsert:n4.upsert},i),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(r=new FormData,r.append("cacheControl",c.cacheControl),r.append("",s)):typeof FormData<"u"&&s instanceof FormData?(r=s,r.append("cacheControl",c.cacheControl)):(r=s,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType);let g=yield F1(this.fetch,l.toString(),r,{headers:h});return{data:{path:e,fullPath:g.Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(A(r))return{data:null,error:r};throw r}})}createSignedUploadUrl(o,t){return V(this,void 0,void 0,function*(){try{let s=this._getFinalPath(o),i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");let e=yield P(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),n=new URL(this.url+e.url),l=n.searchParams.get("token");if(!l)throw new m1("No token returned by API");return{data:{signedUrl:n.toString(),path:o,token:l},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(A(s))return{data:null,error:s};throw s}})}update(o,t,s){return V(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",o,t,s)})}move(o,t,s){return V(this,void 0,void 0,function*(){try{return{data:yield P(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:o,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(A(i))return{data:null,error:i};throw i}})}copy(o,t,s){return V(this,void 0,void 0,function*(){try{return{data:{path:(yield P(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:o,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(A(i))return{data:null,error:i};throw i}})}createSignedUrl(o,t,s){return V(this,void 0,void 0,function*(){try{let i=this._getFinalPath(o),e=yield P(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers}),n=s?.download?`&download=${s.download===!0?"":s.download}`:"";return e={signedUrl:encodeURI(`${this.url}${e.signedURL}${n}`)},{data:e,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(A(i))return{data:null,error:i};throw i}})}createSignedUrls(o,t,s){return V(this,void 0,void 0,function*(){try{let i=yield P(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:o},{headers:this.headers}),e=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(n=>Object.assign(Object.assign({},n),{signedUrl:n.signedURL?encodeURI(`${this.url}${n.signedURL}${e}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(A(i))return{data:null,error:i};throw i}})}download(o,t){return V(this,void 0,void 0,function*(){let i=typeof t?.transform<"u"?"render/image/authenticated":"object",e=this.transformOptsToQueryString(t?.transform||{}),n=e?`?${e}`:"";try{let l=this._getFinalPath(o);return{data:yield(yield x1(this.fetch,`${this.url}/${i}/${l}${n}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(A(l))return{data:null,error:l};throw l}})}info(o){return V(this,void 0,void 0,function*(){let t=this._getFinalPath(o);try{let s=yield x1(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:e0(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(A(s))return{data:null,error:s};throw s}})}exists(o){return V(this,void 0,void 0,function*(){let t=this._getFinalPath(o);try{return yield e4(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(A(s)&&s instanceof Z){let i=s.originalError;if([400,404].includes(i?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(o,t){let s=this._getFinalPath(o),i=[],e=t?.download?`download=${t.download===!0?"":t.download}`:"";e!==""&&i.push(e);let l=typeof t?.transform<"u"?"render/image":"object",r=this.transformOptsToQueryString(t?.transform||{});r!==""&&i.push(r);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${c}`)}}}remove(o){return V(this,void 0,void 0,function*(){try{return{data:yield l0(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:o},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(A(t))return{data:null,error:t};throw t}})}list(o,t,s){return V(this,void 0,void 0,function*(){try{let i=Object.assign(Object.assign(Object.assign({},z3),t),{prefix:o||""});return{data:yield P(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(A(i))return{data:null,error:i};throw i}})}listV2(o,t){return V(this,void 0,void 0,function*(){try{let s=Object.assign({},o);return{data:yield P(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(A(s))return{data:null,error:s};throw s}})}encodeMetadata(o){return JSON.stringify(o)}toBase64(o){return typeof Buffer<"u"?Buffer.from(o).toString("base64"):btoa(o)}_getFinalPath(o){return`${this.bucketId}/${o.replace(/^\/+/,"")}`}_removeEmptyFolders(o){return o.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(o){let t=[];return o.width&&t.push(`width=${o.width}`),o.height&&t.push(`height=${o.height}`),o.resize&&t.push(`resize=${o.resize}`),o.format&&t.push(`format=${o.format}`),o.quality&&t.push(`quality=${o.quality}`),t.join("&")}};var l4="2.12.1";var r4={"X-Client-Info":`storage-js/${l4}`};var f1=function(a,o,t,s){function i(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(e,n){function l(h){try{c(s.next(h))}catch(g){n(g)}}function r(h){try{c(s.throw(h))}catch(g){n(g)}}function c(h){h.done?e(h.value):i(h.value).then(l,r)}c((s=s.apply(a,o||[])).next())})},c0=class{constructor(o,t={},s,i){this.shouldThrowOnError=!1;let e=new URL(o);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(e.hostname)&&!e.hostname.includes("storage.supabase.")&&(e.hostname=e.hostname.replace("supabase.","storage.supabase.")),this.url=e.href,this.headers=Object.assign(Object.assign({},r4),t),this.fetch=n0(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return f1(this,void 0,void 0,function*(){try{return{data:yield x1(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(A(o))return{data:null,error:o};throw o}})}getBucket(o){return f1(this,void 0,void 0,function*(){try{return{data:yield x1(this.fetch,`${this.url}/bucket/${o}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(A(t))return{data:null,error:t};throw t}})}createBucket(o,t={public:!1}){return f1(this,void 0,void 0,function*(){try{return{data:yield P(this.fetch,`${this.url}/bucket`,{id:o,name:o,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(A(s))return{data:null,error:s};throw s}})}updateBucket(o,t){return f1(this,void 0,void 0,function*(){try{return{data:yield F1(this.fetch,`${this.url}/bucket/${o}`,{id:o,name:o,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(A(s))return{data:null,error:s};throw s}})}emptyBucket(o){return f1(this,void 0,void 0,function*(){try{return{data:yield P(this.fetch,`${this.url}/bucket/${o}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(A(t))return{data:null,error:t};throw t}})}deleteBucket(o){return f1(this,void 0,void 0,function*(){try{return{data:yield l0(this.fetch,`${this.url}/bucket/${o}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(A(t))return{data:null,error:t};throw t}})}};var N1=class extends c0{constructor(o,t={},s,i){super(o,t,s,i)}from(o){return new r0(this.url,this.headers,o,this.fetch)}};var c4="2.57.4";var W1="";typeof Deno<"u"?W1="deno":typeof document<"u"?W1="web":typeof navigator<"u"&&navigator.product==="ReactNative"?W1="react-native":W1="node";var y3={"X-Client-Info":`supabase-js-${W1}/${c4}`},h4={headers:y3},v4={schema:"public"},g4={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},w4={};b2();var B3=function(a,o,t,s){function i(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(e,n){function l(h){try{c(s.next(h))}catch(g){n(g)}}function r(h){try{c(s.throw(h))}catch(g){n(g)}}function c(h){h.done?e(h.value):i(h.value).then(l,r)}c((s=s.apply(a,o||[])).next())})},L3=a=>{let o;return a?o=a:typeof fetch>"u"?o=H2:o=fetch,(...t)=>o(...t)},A3=()=>typeof Headers>"u"?_2:Headers,d4=(a,o,t)=>{let s=L3(t),i=A3();return(e,n)=>B3(void 0,void 0,void 0,function*(){var l;let r=(l=yield o())!==null&&l!==void 0?l:a,c=new i(n?.headers);return c.has("apikey")||c.set("apikey",a),c.has("Authorization")||c.set("Authorization",`Bearer ${r}`),s(e,Object.assign(Object.assign({},n),{headers:c}))})};var C3=function(a,o,t,s){function i(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(e,n){function l(h){try{c(s.next(h))}catch(g){n(g)}}function r(h){try{c(s.throw(h))}catch(g){n(g)}}function c(h){h.done?e(h.value):i(h.value).then(l,r)}c((s=s.apply(a,o||[])).next())})};function S3(a){return a.endsWith("/")?a:a+"/"}function p4(a,o){var t,s;let{db:i,auth:e,realtime:n,global:l}=a,{db:r,auth:c,realtime:h,global:g}=o,d={db:Object.assign(Object.assign({},r),i),auth:Object.assign(Object.assign({},c),e),realtime:Object.assign(Object.assign({},h),n),storage:{},global:Object.assign(Object.assign(Object.assign({},g),l),{headers:Object.assign(Object.assign({},(t=g?.headers)!==null&&t!==void 0?t:{}),(s=l?.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>C3(this,void 0,void 0,function*(){return""})};return a.accessToken?d.accessToken=a.accessToken:delete d.accessToken,d}function u4(a){let o=a?.trim();if(!o)throw new Error("supabaseUrl is required.");if(!o.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(S3(o))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var h0="2.71.1";var o1=30*1e3,v0=3,g0=v0*o1,m4="http://localhost:9999",x4="supabase.auth.token";var f4={"X-Client-Info":`gotrue-js/${h0}`};var K1="X-Supabase-Api-Version",G0={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},M4=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,k4=600*1e3;var G1=class extends Error{constructor(o,t,s){super(o),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}};function u(a){return typeof a=="object"&&a!==null&&"__isAuthError"in a}var w0=class extends G1{constructor(o,t,s){super(o,t,s),this.name="AuthApiError",this.status=t,this.code=s}};function z4(a){return u(a)&&a.name==="AuthApiError"}var M1=class extends G1{constructor(o,t){super(o),this.name="AuthUnknownError",this.originalError=t}},q=class extends G1{constructor(o,t,s,i){super(o,s,i),this.name=t,this.status=s}},R=class extends q{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function y4(a){return u(a)&&a.name==="AuthSessionMissingError"}var s1=class extends q{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},i1=class extends q{constructor(o){super(o,"AuthInvalidCredentialsError",400,void 0)}},a1=class extends q{constructor(o,t=null){super(o,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function B4(a){return u(a)&&a.name==="AuthImplicitGrantRedirectError"}var J1=class extends q{constructor(o,t=null){super(o,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},k1=class extends q{constructor(o,t){super(o,"AuthRetryableFetchError",t,void 0)}};function d0(a){return u(a)&&a.name==="AuthRetryableFetchError"}var Q1=class extends q{constructor(o,t,s){super(o,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}};var e1=class extends q{constructor(o){super(o,"AuthInvalidJwtError",400,"invalid_jwt")}};var p0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),L4=` 	
\r=`.split(""),H3=(()=>{let a=new Array(128);for(let o=0;o<a.length;o+=1)a[o]=-1;for(let o=0;o<L4.length;o+=1)a[L4[o].charCodeAt(0)]=-2;for(let o=0;o<p0.length;o+=1)a[p0[o].charCodeAt(0)]=o;return a})();function A4(a,o,t){if(a!==null)for(o.queue=o.queue<<8|a,o.queuedBits+=8;o.queuedBits>=6;){let s=o.queue>>o.queuedBits-6&63;t(p0[s]),o.queuedBits-=6}else if(o.queuedBits>0)for(o.queue=o.queue<<6-o.queuedBits,o.queuedBits=6;o.queuedBits>=6;){let s=o.queue>>o.queuedBits-6&63;t(p0[s]),o.queuedBits-=6}}function C4(a,o,t){let s=H3[a];if(s>-1)for(o.queue=o.queue<<6|s,o.queuedBits+=6;o.queuedBits>=8;)t(o.queue>>o.queuedBits-8&255),o.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(a)}"`)}}function J0(a){let o=[],t=n=>{o.push(String.fromCodePoint(n))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},e=n=>{V3(n,s,t)};for(let n=0;n<a.length;n+=1)C4(a.charCodeAt(n),i,e);return o.join("")}function _3(a,o){if(a<=127){o(a);return}else if(a<=2047){o(192|a>>6),o(128|a&63);return}else if(a<=65535){o(224|a>>12),o(128|a>>6&63),o(128|a&63);return}else if(a<=1114111){o(240|a>>18),o(128|a>>12&63),o(128|a>>6&63),o(128|a&63);return}throw new Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}function b3(a,o){for(let t=0;t<a.length;t+=1){let s=a.charCodeAt(t);if(s>55295&&s<=56319){let i=(s-55296)*1024&65535;s=(a.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}_3(s,o)}}function V3(a,o,t){if(o.utf8seq===0){if(a<=127){t(a);return}for(let s=1;s<6;s+=1)if((a>>7-s&1)===0){o.utf8seq=s;break}if(o.utf8seq===2)o.codepoint=a&31;else if(o.utf8seq===3)o.codepoint=a&15;else if(o.utf8seq===4)o.codepoint=a&7;else throw new Error("Invalid UTF-8 sequence");o.utf8seq-=1}else if(o.utf8seq>0){if(a<=127)throw new Error("Invalid UTF-8 sequence");o.codepoint=o.codepoint<<6|a&63,o.utf8seq-=1,o.utf8seq===0&&t(o.codepoint)}}function S4(a){let o=[],t={queue:0,queuedBits:0},s=i=>{o.push(i)};for(let i=0;i<a.length;i+=1)C4(a.charCodeAt(i),t,s);return new Uint8Array(o)}function H4(a){let o=[];return b3(a,t=>o.push(t)),new Uint8Array(o)}function _4(a){let o=[],t={queue:0,queuedBits:0},s=i=>{o.push(i)};return a.forEach(i=>A4(i,t,s)),A4(null,t,s),o.join("")}function b4(a){return Math.round(Date.now()/1e3)+a}function V4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){let o=Math.random()*16|0;return(a=="x"?o:o&3|8).toString(16)})}var I=()=>typeof window<"u"&&typeof document<"u",n1={tested:!1,writable:!1},u0=()=>{if(!I())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(n1.tested)return n1.writable;let a=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(a,a),globalThis.localStorage.removeItem(a),n1.tested=!0,n1.writable=!0}catch{n1.tested=!0,n1.writable=!1}return n1.writable};function j4(a){let o={},t=new URL(a);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,e)=>{o[e]=i})}catch{}return t.searchParams.forEach((s,i)=>{o[i]=s}),o}var m0=a=>{let o;return a?o=a:typeof fetch>"u"?o=(...t)=>import("./chunk-VJO5QO2U.js").then(({default:s})=>s(...t)):o=fetch,(...t)=>o(...t)},O4=a=>typeof a=="object"&&a!==null&&"status"in a&&"ok"in a&&"json"in a&&typeof a.json=="function",l1=(a,o,t)=>v(null,null,function*(){yield a.setItem(o,JSON.stringify(t))}),Q=(a,o)=>v(null,null,function*(){let t=yield a.getItem(o);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),W=(a,o)=>v(null,null,function*(){yield a.removeItem(o)}),X1=class a{constructor(){this.promise=new a.promiseConstructor((o,t)=>{this.resolve=o,this.reject=t})}};X1.promiseConstructor=Promise;function x0(a){let o=a.split(".");if(o.length!==3)throw new e1("Invalid JWT structure");for(let s=0;s<o.length;s++)if(!M4.test(o[s]))throw new e1("JWT not in base64url format");return{header:JSON.parse(J0(o[0])),payload:JSON.parse(J0(o[1])),signature:S4(o[2]),raw:{header:o[0],payload:o[1]}}}function T4(a){return v(this,null,function*(){return yield new Promise(o=>{setTimeout(()=>o(null),a)})})}function E4(a,o){return new Promise((s,i)=>{v(null,null,function*(){for(let e=0;e<1/0;e++)try{let n=yield a(e);if(!o(e,null,n)){s(n);return}}catch(n){if(!o(e,n)){i(n);return}}})})}function j3(a){return("0"+a.toString(16)).substr(-2)}function O3(){let o=new Uint32Array(56);if(typeof crypto>"u"){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length,i="";for(let e=0;e<56;e++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(o),Array.from(o,j3).join("")}function T3(a){return v(this,null,function*(){let t=new TextEncoder().encode(a),s=yield crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(e=>String.fromCharCode(e)).join("")})}function E3(a){return v(this,null,function*(){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a;let t=yield T3(a);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function r1(a,o,t=!1){return v(this,null,function*(){let s=O3(),i=s;t&&(i+="/PASSWORD_RECOVERY"),yield l1(a,`${o}-code-verifier`,i);let e=yield E3(s);return[e,s===e?"plain":"s256"]})}var P3=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function P4(a){let o=a.headers.get(K1);if(!o||!o.match(P3))return null;try{return new Date(`${o}T00:00:00.0Z`)}catch{return null}}function R4(a){if(!a)throw new Error("Missing exp claim");let o=Math.floor(Date.now()/1e3);if(a<=o)throw new Error("JWT has expired")}function I4(a){switch(a){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var R3=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function c1(a){if(!R3.test(a))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function f0(){let a={};return new Proxy(a,{get:(o,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){let s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(o,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(o,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Q0(a){return JSON.parse(JSON.stringify(a))}var I3=function(a,o){var t={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&o.indexOf(s)<0&&(t[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(a);i<s.length;i++)o.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(a,s[i])&&(t[s[i]]=a[s[i]]);return t},h1=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),U3=[502,503,504];function U4(a){return v(this,null,function*(){var o;if(!O4(a))throw new k1(h1(a),0);if(U3.includes(a.status))throw new k1(h1(a),a.status);let t;try{t=yield a.json()}catch(e){throw new M1(h1(e),e)}let s,i=P4(a);if(i&&i.getTime()>=G0["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Q1(h1(t),a.status,((o=t.weak_password)===null||o===void 0?void 0:o.reasons)||[]);if(s==="session_not_found")throw new R}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((e,n)=>e&&typeof n=="string",!0))throw new Q1(h1(t),a.status,t.weak_password.reasons);throw new w0(h1(t),a.status||500,s)})}var q3=(a,o,t,s)=>{let i={method:a,headers:o?.headers||{}};return a==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},o?.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};function M(a,o,t,s){return v(this,null,function*(){var i;let e=Object.assign({},s?.headers);e[K1]||(e[K1]=G0["2024-01-01"].name),s?.jwt&&(e.Authorization=`Bearer ${s.jwt}`);let n=(i=s?.query)!==null&&i!==void 0?i:{};s?.redirectTo&&(n.redirect_to=s.redirectTo);let l=Object.keys(n).length?"?"+new URLSearchParams(n).toString():"",r=yield $3(a,o,t+l,{headers:e,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(r):{data:Object.assign({},r),error:null}})}function $3(a,o,t,s,i,e){return v(this,null,function*(){let n=q3(o,s,i,e),l;try{l=yield a(t,Object.assign({},n))}catch(r){throw console.error(r),new k1(h1(r),0)}if(l.ok||(yield U4(l)),s?.noResolveJson)return l;try{return yield l.json()}catch(r){yield U4(r)}})}function $(a){var o;let t=null;D3(a)&&(t=Object.assign({},a),a.expires_at||(t.expires_at=b4(a.expires_in)));let s=(o=a.user)!==null&&o!==void 0?o:a;return{data:{session:t,user:s},error:null}}function X0(a){let o=$(a);return!o.error&&a.weak_password&&typeof a.weak_password=="object"&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&typeof a.weak_password.message=="string"&&a.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(o.data.weak_password=a.weak_password),o}function D(a){var o;return{data:{user:(o=a.user)!==null&&o!==void 0?o:a},error:null}}function q4(a){return{data:a,error:null}}function $4(a){let{action_link:o,email_otp:t,hashed_token:s,redirect_to:i,verification_type:e}=a,n=I3(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:o,email_otp:t,hashed_token:s,redirect_to:i,verification_type:e},r=Object.assign({},n);return{data:{properties:l,user:r},error:null}}function D4(a){return a}function D3(a){return a.access_token&&a.refresh_token&&a.expires_in}var M0=["global","local","others"];var F3=function(a,o){var t={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&o.indexOf(s)<0&&(t[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(a);i<s.length;i++)o.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(a,s[i])&&(t[s[i]]=a[s[i]]);return t},z1=class{constructor({url:o="",headers:t={},fetch:s}){this.url=o,this.headers=t,this.fetch=m0(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(s){return v(this,arguments,function*(o,t=M0[0]){if(M0.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${M0.join(", ")}`);try{return yield M(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:o,noResolveJson:!0}),{data:null,error:null}}catch(i){if(u(i))return{data:null,error:i};throw i}})}inviteUserByEmail(s){return v(this,arguments,function*(o,t={}){try{return yield M(this.fetch,"POST",`${this.url}/invite`,{body:{email:o,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:D})}catch(i){if(u(i))return{data:{user:null},error:i};throw i}})}generateLink(o){return v(this,null,function*(){try{let{options:t}=o,s=F3(o,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s?.newEmail,delete i.newEmail),yield M(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:$4,redirectTo:t?.redirectTo})}catch(t){if(u(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(o){return v(this,null,function*(){try{return yield M(this.fetch,"POST",`${this.url}/admin/users`,{body:o,headers:this.headers,xform:D})}catch(t){if(u(t))return{data:{user:null},error:t};throw t}})}listUsers(o){return v(this,null,function*(){var t,s,i,e,n,l,r;try{let c={nextPage:null,lastPage:0,total:0},h=yield M(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=o?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(e=(i=o?.perPage)===null||i===void 0?void 0:i.toString())!==null&&e!==void 0?e:""},xform:D4});if(h.error)throw h.error;let g=yield h.json(),d=(n=h.headers.get("x-total-count"))!==null&&n!==void 0?n:0,w=(r=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&r!==void 0?r:[];return w.length>0&&(w.forEach(m=>{let x=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),f=JSON.parse(m.split(";")[1].split("=")[1]);c[`${f}Page`]=x}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},g),c),error:null}}catch(c){if(u(c))return{data:{users:[]},error:c};throw c}})}getUserById(o){return v(this,null,function*(){c1(o);try{return yield M(this.fetch,"GET",`${this.url}/admin/users/${o}`,{headers:this.headers,xform:D})}catch(t){if(u(t))return{data:{user:null},error:t};throw t}})}updateUserById(o,t){return v(this,null,function*(){c1(o);try{return yield M(this.fetch,"PUT",`${this.url}/admin/users/${o}`,{body:t,headers:this.headers,xform:D})}catch(s){if(u(s))return{data:{user:null},error:s};throw s}})}deleteUser(o,t=!1){return v(this,null,function*(){c1(o);try{return yield M(this.fetch,"DELETE",`${this.url}/admin/users/${o}`,{headers:this.headers,body:{should_soft_delete:t},xform:D})}catch(s){if(u(s))return{data:{user:null},error:s};throw s}})}_listFactors(o){return v(this,null,function*(){c1(o.userId);try{let{data:t,error:s}=yield M(this.fetch,"GET",`${this.url}/admin/users/${o.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(u(t))return{data:null,error:t};throw t}})}_deleteFactor(o){return v(this,null,function*(){c1(o.userId),c1(o.id);try{return{data:yield M(this.fetch,"DELETE",`${this.url}/admin/users/${o.userId}/factors/${o.id}`,{headers:this.headers}),error:null}}catch(t){if(u(t))return{data:null,error:t};throw t}})}};function Y0(a={}){return{getItem:o=>a[o]||null,setItem:(o,t)=>{a[o]=t},removeItem:o=>{delete a[o]}}}function F4(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var v1={debug:!!(globalThis&&u0()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},Y1=class extends Error{constructor(o){super(o),this.isAcquireTimeout=!0}},k0=class extends Y1{};function Z0(a,o,t){return v(this,null,function*(){v1.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",a,o);let s=new globalThis.AbortController;return o>0&&setTimeout(()=>{s.abort(),v1.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",a)},o),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(a,o===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},i=>v(null,null,function*(){if(i){v1.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",a,i.name);try{return yield t()}finally{v1.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",a,i.name)}}else{if(o===0)throw v1.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",a),new k0(`Acquiring an exclusive Navigator LockManager lock "${a}" immediately failed`);if(v1.debug)try{let e=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield t()}})))})}F4();var N3={url:m4,storageKey:x4,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:f4,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function N4(a,o,t){return v(this,null,function*(){return yield t()})}var y1={},t2=(()=>{class a{constructor(t){var s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=a.nextInstanceID,a.nextInstanceID+=1,this.instanceID>0&&I()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let e=Object.assign(Object.assign({},N3),t);if(this.logDebugMessages=!!e.debug,typeof e.debug=="function"&&(this.logger=e.debug),this.persistSession=e.persistSession,this.storageKey=e.storageKey,this.autoRefreshToken=e.autoRefreshToken,this.admin=new z1({url:e.url,headers:e.headers,fetch:e.fetch}),this.url=e.url,this.headers=e.headers,this.fetch=m0(e.fetch),this.lock=e.lock||N4,this.detectSessionInUrl=e.detectSessionInUrl,this.flowType=e.flowType,this.hasCustomAuthorizationHeader=e.hasCustomAuthorizationHeader,e.lock?this.lock=e.lock:I()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=Z0:this.lock=N4,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(e.storage?this.storage=e.storage:u0()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Y0(this.memoryStorage)),e.userStorage&&(this.userStorage=e.userStorage)):(this.memoryStorage={},this.storage=Y0(this.memoryStorage)),I()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",n=>v(this,null,function*(){this._debug("received broadcast notification from other tab or client",n),yield this._notifyAllSubscribers(n.data.event,n.data.session,!1)}))}this.initialize()}get jwks(){var t,s;return(s=(t=y1[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){y1[this.storageKey]=Object.assign(Object.assign({},y1[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=y1[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){y1[this.storageKey]=Object.assign(Object.assign({},y1[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${h0}) ${new Date().toISOString()}`,...t),this}initialize(){return v(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=v(this,null,function*(){return yield this._acquireLock(-1,()=>v(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return v(this,null,function*(){var t;try{let s=j4(window.location.href),i="none";if(this._isImplicitGrantCallback(s)?i="implicit":(yield this._isPKCECallback(s))&&(i="pkce"),I()&&this.detectSessionInUrl&&i!=="none"){let{data:e,error:n}=yield this._getSessionFromURL(s,i);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),B4(n)){let c=(t=n.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:n}}return yield this._removeSession(),{error:n}}let{session:l,redirectType:r}=e;return this._debug("#_initialize()","detected session in URL",l,"redirect type",r),yield this._saveSession(l),setTimeout(()=>v(this,null,function*(){r==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",l):yield this._notifyAllSubscribers("SIGNED_IN",l)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(s){return u(s)?{error:s}:{error:new M1("Unexpected error during initialization",s)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(t){return v(this,null,function*(){var s,i,e;try{let n=yield M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(e=t?.options)===null||e===void 0?void 0:e.captchaToken}},xform:$}),{data:l,error:r}=n;if(r||!l)return{data:{user:null,session:null},error:r};let c=l.session,h=l.user;return l.session&&(yield this._saveSession(l.session),yield this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(n){if(u(n))return{data:{user:null,session:null},error:n};throw n}})}signUp(t){return v(this,null,function*(){var s,i,e;try{let n;if("email"in t){let{email:g,password:d,options:w}=t,m=null,x=null;this.flowType==="pkce"&&([m,x]=yield r1(this.storage,this.storageKey)),n=yield M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:w?.emailRedirectTo,body:{email:g,password:d,data:(s=w?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:w?.captchaToken},code_challenge:m,code_challenge_method:x},xform:$})}else if("phone"in t){let{phone:g,password:d,options:w}=t;n=yield M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:d,data:(i=w?.data)!==null&&i!==void 0?i:{},channel:(e=w?.channel)!==null&&e!==void 0?e:"sms",gotrue_meta_security:{captcha_token:w?.captchaToken}},xform:$})}else throw new i1("You must provide either an email or phone number and a password");let{data:l,error:r}=n;if(r||!l)return{data:{user:null,session:null},error:r};let c=l.session,h=l.user;return l.session&&(yield this._saveSession(l.session),yield this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(n){if(u(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithPassword(t){return v(this,null,function*(){try{let s;if("email"in t){let{email:n,password:l,options:r}=t;s=yield M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:l,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:X0})}else if("phone"in t){let{phone:n,password:l,options:r}=t;s=yield M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:l,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:X0})}else throw new i1("You must provide either an email or phone number and a password");let{data:i,error:e}=s;return e?{data:{user:null,session:null},error:e}:!i||!i.session||!i.user?{data:{user:null,session:null},error:new s1}:(i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:e})}catch(s){if(u(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithOAuth(t){return v(this,null,function*(){var s,i,e,n;return yield this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(e=t.options)===null||e===void 0?void 0:e.queryParams,skipBrowserRedirect:(n=t.options)===null||n===void 0?void 0:n.skipBrowserRedirect})})}exchangeCodeForSession(t){return v(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>v(this,null,function*(){return this._exchangeCodeForSession(t)}))})}signInWithWeb3(t){return v(this,null,function*(){let{chain:s}=t;if(s==="solana")return yield this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)})}signInWithSolana(t){return v(this,null,function*(){var s,i,e,n,l,r,c,h,g,d,w,m;let x,f;if("message"in t)x=t.message,f=t.signature;else{let{chain:k,wallet:B,statement:S,options:p}=t,z;if(I())if(typeof B=="object")z=B;else{let L=window;if("solana"in L&&typeof L.solana=="object"&&("signIn"in L.solana&&typeof L.solana.signIn=="function"||"signMessage"in L.solana&&typeof L.solana.signMessage=="function"))z=L.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof B!="object"||!p?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=B}let g1=new URL((s=p?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in z&&z.signIn){let L=yield z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},p?.signInWithSolana),{version:"1",domain:g1.host,uri:g1.href}),S?{statement:S}:null)),b;if(Array.isArray(L)&&L[0]&&typeof L[0]=="object")b=L[0];else if(L&&typeof L=="object"&&"signedMessage"in L&&"signature"in L)b=L;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in b&&"signature"in b&&(typeof b.signedMessage=="string"||b.signedMessage instanceof Uint8Array)&&b.signature instanceof Uint8Array)x=typeof b.signedMessage=="string"?b.signedMessage:new TextDecoder().decode(b.signedMessage),f=b.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${g1.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...S?["",S,""]:[""],"Version: 1",`URI: ${g1.href}`,`Issued At: ${(e=(i=p?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&e!==void 0?e:new Date().toISOString()}`,...!((n=p?.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${p.signInWithSolana.notBefore}`]:[],...!((l=p?.signInWithSolana)===null||l===void 0)&&l.expirationTime?[`Expiration Time: ${p.signInWithSolana.expirationTime}`]:[],...!((r=p?.signInWithSolana)===null||r===void 0)&&r.chainId?[`Chain ID: ${p.signInWithSolana.chainId}`]:[],...!((c=p?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${p.signInWithSolana.nonce}`]:[],...!((h=p?.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${p.signInWithSolana.requestId}`]:[],...!((d=(g=p?.signInWithSolana)===null||g===void 0?void 0:g.resources)===null||d===void 0)&&d.length?["Resources",...p.signInWithSolana.resources.map(b=>`- ${b}`)]:[]].join(`
`);let L=yield z.signMessage(new TextEncoder().encode(x),"utf8");if(!L||!(L instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");f=L}}try{let{data:k,error:B}=yield M(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:_4(f)},!((w=t.options)===null||w===void 0)&&w.captchaToken?{gotrue_meta_security:{captcha_token:(m=t.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:$});if(B)throw B;return!k||!k.session||!k.user?{data:{user:null,session:null},error:new s1}:(k.session&&(yield this._saveSession(k.session),yield this._notifyAllSubscribers("SIGNED_IN",k.session)),{data:Object.assign({},k),error:B})}catch(k){if(u(k))return{data:{user:null,session:null},error:k};throw k}})}_exchangeCodeForSession(t){return v(this,null,function*(){let s=yield Q(this.storage,`${this.storageKey}-code-verifier`),[i,e]=(s??"").split("/");try{let{data:n,error:l}=yield M(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:i},xform:$});if(yield W(this.storage,`${this.storageKey}-code-verifier`),l)throw l;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new s1}:(n.session&&(yield this._saveSession(n.session),yield this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:e??null}),error:l})}catch(n){if(u(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}})}signInWithIdToken(t){return v(this,null,function*(){try{let{options:s,provider:i,token:e,access_token:n,nonce:l}=t,r=yield M(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:e,access_token:n,nonce:l,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:$}),{data:c,error:h}=r;return h?{data:{user:null,session:null},error:h}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new s1}:(c.session&&(yield this._saveSession(c.session),yield this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:h})}catch(s){if(u(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithOtp(t){return v(this,null,function*(){var s,i,e,n,l;try{if("email"in t){let{email:r,options:c}=t,h=null,g=null;this.flowType==="pkce"&&([h,g]=yield r1(this.storage,this.storageKey));let{error:d}=yield M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:h,code_challenge_method:g},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in t){let{phone:r,options:c}=t,{data:h,error:g}=yield M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:r,data:(e=c?.data)!==null&&e!==void 0?e:{},create_user:(n=c?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(l=c?.channel)!==null&&l!==void 0?l:"sms"}});return{data:{user:null,session:null,messageId:h?.message_id},error:g}}throw new i1("You must provide either an email or phone number.")}catch(r){if(u(r))return{data:{user:null,session:null},error:r};throw r}})}verifyOtp(t){return v(this,null,function*(){var s,i;try{let e,n;"options"in t&&(e=(s=t.options)===null||s===void 0?void 0:s.redirectTo,n=(i=t.options)===null||i===void 0?void 0:i.captchaToken);let{data:l,error:r}=yield M(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:n}}),redirectTo:e,xform:$});if(r)throw r;if(!l)throw new Error("An error occurred on token verification.");let c=l.session,h=l.user;return c?.access_token&&(yield this._saveSession(c),yield this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(e){if(u(e))return{data:{user:null,session:null},error:e};throw e}})}signInWithSSO(t){return v(this,null,function*(){var s,i,e;try{let n=null,l=null;return this.flowType==="pkce"&&([n,l]=yield r1(this.storage,this.storageKey)),yield M(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(i=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&i!==void 0?i:void 0}),!((e=t?.options)===null||e===void 0)&&e.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:l}),headers:this.headers,xform:q4})}catch(n){if(u(n))return{data:null,error:n};throw n}})}reauthenticate(){return v(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return v(this,null,function*(){try{return yield this._useSession(t=>v(this,null,function*(){let{data:{session:s},error:i}=t;if(i)throw i;if(!s)throw new R;let{error:e}=yield M(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:e}}))}catch(t){if(u(t))return{data:{user:null,session:null},error:t};throw t}})}resend(t){return v(this,null,function*(){try{let s=`${this.url}/resend`;if("email"in t){let{email:i,type:e,options:n}=t,{error:l}=yield M(this.fetch,"POST",s,{headers:this.headers,body:{email:i,type:e,gotrue_meta_security:{captcha_token:n?.captchaToken}},redirectTo:n?.emailRedirectTo});return{data:{user:null,session:null},error:l}}else if("phone"in t){let{phone:i,type:e,options:n}=t,{data:l,error:r}=yield M(this.fetch,"POST",s,{headers:this.headers,body:{phone:i,type:e,gotrue_meta_security:{captcha_token:n?.captchaToken}}});return{data:{user:null,session:null,messageId:l?.message_id},error:r}}throw new i1("You must provide either an email or phone number and a type")}catch(s){if(u(s))return{data:{user:null,session:null},error:s};throw s}})}getSession(){return v(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){return this._useSession(s=>v(this,null,function*(){return s}))}))})}_acquireLock(t,s){return v(this,null,function*(){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){let i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),e=v(this,null,function*(){return yield i,yield s()});return this.pendingInLock.push(v(this,null,function*(){try{yield e}catch{}})),e}return yield this.lock(`lock:${this.storageKey}`,t,()=>v(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let i=s();for(this.pendingInLock.push(v(this,null,function*(){try{yield i}catch{}})),yield i;this.pendingInLock.length;){let e=[...this.pendingInLock];yield Promise.all(e),this.pendingInLock.splice(0,e.length)}return yield i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(t){return v(this,null,function*(){this._debug("#_useSession","begin");try{let s=yield this.__loadSession();return yield t(s)}finally{this._debug("#_useSession","end")}})}__loadSession(){return v(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null,s=yield Q(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!t)return{data:{session:null},error:null};let i=t.expires_at?t.expires_at*1e3-Date.now()<g0:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.userStorage){let l=yield Q(this.userStorage,this.storageKey+"-user");l?.user?t.user=l.user:t.user=f0()}if(this.storage.isServer&&t.user){let l=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,h,g)=>(!l&&h==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,h,g))})}return{data:{session:t},error:null}}let{session:e,error:n}=yield this._callRefreshToken(t.refresh_token);return n?{data:{session:null},error:n}:{data:{session:e},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(t){return v(this,null,function*(){return t?yield this._getUser(t):(yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){return yield this._getUser()})))})}_getUser(t){return v(this,null,function*(){try{return t?yield M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:D}):yield this._useSession(s=>v(this,null,function*(){var i,e,n;let{data:l,error:r}=s;if(r)throw r;return!(!((i=l.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new R}:yield M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(e=l.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:void 0,xform:D})}))}catch(s){if(u(s))return y4(s)&&(yield this._removeSession(),yield W(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}})}updateUser(i){return v(this,arguments,function*(t,s={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){return yield this._updateUser(t,s)}))})}_updateUser(i){return v(this,arguments,function*(t,s={}){try{return yield this._useSession(e=>v(this,null,function*(){let{data:n,error:l}=e;if(l)throw l;if(!n.session)throw new R;let r=n.session,c=null,h=null;this.flowType==="pkce"&&t.email!=null&&([c,h]=yield r1(this.storage,this.storageKey));let{data:g,error:d}=yield M(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:c,code_challenge_method:h}),jwt:r.access_token,xform:D});if(d)throw d;return r.user=g.user,yield this._saveSession(r),yield this._notifyAllSubscribers("USER_UPDATED",r),{data:{user:r.user},error:null}}))}catch(e){if(u(e))return{data:{user:null},error:e};throw e}})}setSession(t){return v(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){return yield this._setSession(t)}))})}_setSession(t){return v(this,null,function*(){try{if(!t.access_token||!t.refresh_token)throw new R;let s=Date.now()/1e3,i=s,e=!0,n=null,{payload:l}=x0(t.access_token);if(l.exp&&(i=l.exp,e=i<=s),e){let{session:r,error:c}=yield this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!r)return{data:{user:null,session:null},error:null};n=r}else{let{data:r,error:c}=yield this._getUser(t.access_token);if(c)throw c;n={access_token:t.access_token,refresh_token:t.refresh_token,user:r.user,token_type:"bearer",expires_in:i-s,expires_at:i},yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(s){if(u(s))return{data:{session:null,user:null},error:s};throw s}})}refreshSession(t){return v(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){return yield this._refreshSession(t)}))})}_refreshSession(t){return v(this,null,function*(){try{return yield this._useSession(s=>v(this,null,function*(){var i;if(!t){let{data:l,error:r}=s;if(r)throw r;t=(i=l.session)!==null&&i!==void 0?i:void 0}if(!t?.refresh_token)throw new R;let{session:e,error:n}=yield this._callRefreshToken(t.refresh_token);return n?{data:{user:null,session:null},error:n}:e?{data:{user:e.user,session:e},error:null}:{data:{user:null,session:null},error:null}}))}catch(s){if(u(s))return{data:{user:null,session:null},error:s};throw s}})}_getSessionFromURL(t,s){return v(this,null,function*(){try{if(!I())throw new a1("No browser detected.");if(t.error||t.error_description||t.error_code)throw new a1(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new J1("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new a1("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new J1("No code detected.");let{data:S,error:p}=yield this._exchangeCodeForSession(t.code);if(p)throw p;let z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:S.session,redirectType:null},error:null}}let{provider_token:i,provider_refresh_token:e,access_token:n,refresh_token:l,expires_in:r,expires_at:c,token_type:h}=t;if(!n||!r||!l||!h)throw new a1("No session defined in URL");let g=Math.round(Date.now()/1e3),d=parseInt(r),w=g+d;c&&(w=parseInt(c));let m=w-g;m*1e3<=o1&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${d}s`);let x=w-d;g-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,w,g):g-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,w,g);let{data:f,error:k}=yield this._getUser(n);if(k)throw k;let B={provider_token:i,provider_refresh_token:e,access_token:n,expires_in:d,expires_at:w,refresh_token:l,token_type:h,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:B,redirectType:t.type},error:null}}catch(i){if(u(i))return{data:{session:null,redirectType:null},error:i};throw i}})}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}_isPKCECallback(t){return v(this,null,function*(){let s=yield Q(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)})}signOut(){return v(this,arguments,function*(t={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){return yield this._signOut(t)}))})}_signOut(){return v(this,arguments,function*({scope:t}={scope:"global"}){return yield this._useSession(s=>v(this,null,function*(){var i;let{data:e,error:n}=s;if(n)return{error:n};let l=(i=e.session)===null||i===void 0?void 0:i.access_token;if(l){let{error:r}=yield this.admin.signOut(l,t);if(r&&!(z4(r)&&(r.status===404||r.status===401||r.status===403)))return{error:r}}return t!=="others"&&(yield this._removeSession(),yield W(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(t){let s=V4(),i={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,i),v(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){this._emitInitialSession(s)}))}),{data:{subscription:i}}}_emitInitialSession(t){return v(this,null,function*(){return yield this._useSession(s=>v(this,null,function*(){var i,e;try{let{data:{session:n},error:l}=s;if(l)throw l;yield(i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",n),this._debug("INITIAL_SESSION","callback id",t,"session",n)}catch(n){yield(e=this.stateChangeEmitters.get(t))===null||e===void 0?void 0:e.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",t,"error",n),console.error(n)}}))})}resetPasswordForEmail(i){return v(this,arguments,function*(t,s={}){let e=null,n=null;this.flowType==="pkce"&&([e,n]=yield r1(this.storage,this.storageKey,!0));try{return yield M(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:e,code_challenge_method:n,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(l){if(u(l))return{data:null,error:l};throw l}})}getUserIdentities(){return v(this,null,function*(){var t;try{let{data:s,error:i}=yield this.getUser();if(i)throw i;return{data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(s){if(u(s))return{data:null,error:s};throw s}})}linkIdentity(t){return v(this,null,function*(){var s;try{let{data:i,error:e}=yield this._useSession(n=>v(this,null,function*(){var l,r,c,h,g;let{data:d,error:w}=n;if(w)throw w;let m=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(l=t.options)===null||l===void 0?void 0:l.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return yield M(this.fetch,"GET",m,{headers:this.headers,jwt:(g=(h=d.session)===null||h===void 0?void 0:h.access_token)!==null&&g!==void 0?g:void 0})}));if(e)throw e;return I()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(i?.url),{data:{provider:t.provider,url:i?.url},error:null}}catch(i){if(u(i))return{data:{provider:t.provider,url:null},error:i};throw i}})}unlinkIdentity(t){return v(this,null,function*(){try{return yield this._useSession(s=>v(this,null,function*(){var i,e;let{data:n,error:l}=s;if(l)throw l;return yield M(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(e=(i=n.session)===null||i===void 0?void 0:i.access_token)!==null&&e!==void 0?e:void 0})}))}catch(s){if(u(s))return{data:null,error:s};throw s}})}_refreshAccessToken(t){return v(this,null,function*(){let s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{let i=Date.now();return yield E4(e=>v(this,null,function*(){return e>0&&(yield T4(200*Math.pow(2,e-1))),this._debug(s,"refreshing attempt",e),yield M(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:$})}),(e,n)=>{let l=200*Math.pow(2,e);return n&&d0(n)&&Date.now()+l-i<o1})}catch(i){if(this._debug(s,"error",i),u(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(s,"end")}})}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}_handleProviderSignIn(t,s){return v(this,null,function*(){let i=yield this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",i),I()&&!s.skipBrowserRedirect&&window.location.assign(i),{data:{provider:t,url:i},error:null}})}_recoverAndRefresh(){return v(this,null,function*(){var t,s;let i="#_recoverAndRefresh()";this._debug(i,"begin");try{let e=yield Q(this.storage,this.storageKey);if(e&&this.userStorage){let l=yield Q(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!l&&(l={user:e.user},yield l1(this.userStorage,this.storageKey+"-user",l)),e.user=(t=l?.user)!==null&&t!==void 0?t:f0()}else if(e&&!e.user&&!e.user){let l=yield Q(this.storage,this.storageKey+"-user");l&&l?.user?(e.user=l.user,yield W(this.storage,this.storageKey+"-user"),yield l1(this.storage,this.storageKey,e)):e.user=f0()}if(this._debug(i,"session from storage",e),!this._isValidSession(e)){this._debug(i,"session is not valid"),e!==null&&(yield this._removeSession());return}let n=((s=e.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<g0;if(this._debug(i,`session has${n?"":" not"} expired with margin of ${g0}s`),n){if(this.autoRefreshToken&&e.refresh_token){let{error:l}=yield this._callRefreshToken(e.refresh_token);l&&(console.error(l),d0(l)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",l),yield this._removeSession()))}}else if(e.user&&e.user.__isUserNotAvailableProxy===!0)try{let{data:l,error:r}=yield this._getUser(e.access_token);!r&&l?.user?(e.user=l.user,yield this._saveSession(e),yield this._notifyAllSubscribers("SIGNED_IN",e)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(l){console.error("Error getting user data:",l),this._debug(i,"error getting user data, skipping SIGNED_IN notification",l)}else yield this._notifyAllSubscribers("SIGNED_IN",e)}catch(e){this._debug(i,"error",e),console.error(e);return}finally{this._debug(i,"end")}})}_callRefreshToken(t){return v(this,null,function*(){var s,i;if(!t)throw new R;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let e=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{this.refreshingDeferred=new X1;let{data:n,error:l}=yield this._refreshAccessToken(t);if(l)throw l;if(!n.session)throw new R;yield this._saveSession(n.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);let r={session:n.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(n){if(this._debug(e,"error",n),u(n)){let l={session:null,error:n};return d0(n)||(yield this._removeSession()),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(l),l}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(n),n}finally{this.refreshingDeferred=null,this._debug(e,"end")}})}_notifyAllSubscribers(t,s,i=!0){return v(this,null,function*(){let e=`#_notifyAllSubscribers(${t})`;this._debug(e,"begin",s,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:t,session:s});let n=[],l=Array.from(this.stateChangeEmitters.values()).map(r=>v(this,null,function*(){try{yield r.callback(t,s)}catch(c){n.push(c)}}));if(yield Promise.all(l),n.length>0){for(let r=0;r<n.length;r+=1)console.error(n[r]);throw n[0]}}finally{this._debug(e,"end")}})}_saveSession(t){return v(this,null,function*(){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;let s=Object.assign({},t),i=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&s.user&&(yield l1(this.userStorage,this.storageKey+"-user",{user:s.user}));let e=Object.assign({},s);delete e.user;let n=Q0(e);yield l1(this.storage,this.storageKey,n)}else{let e=Q0(s);yield l1(this.storage,this.storageKey,e)}})}_removeSession(){return v(this,null,function*(){this._debug("#_removeSession()"),yield W(this.storage,this.storageKey),yield W(this.storage,this.storageKey+"-code-verifier"),yield W(this.storage,this.storageKey+"-user"),this.userStorage&&(yield W(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&I()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}_startAutoRefresh(){return v(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let t=setInterval(()=>this._autoRefreshTokenTick(),o1);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(()=>v(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return v(this,null,function*(){this._debug("#_stopAutoRefresh()");let t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)})}startAutoRefresh(){return v(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return v(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return v(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>v(this,null,function*(){try{let t=Date.now();try{return yield this._useSession(s=>v(this,null,function*(){let{data:{session:i}}=s;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let e=Math.floor((i.expires_at*1e3-t)/o1);this._debug("#_autoRefreshTokenTick()",`access token expires in ${e} ticks, a tick lasts ${o1}ms, refresh threshold is ${v0} ticks`),e<=v0&&(yield this._callRefreshToken(i.refresh_token))}))}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(t.isAcquireTimeout||t instanceof Y1)this._debug("auto refresh token tick lock not available");else throw t}})}_handleVisibilityChange(){return v(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!I()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>v(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})}_onVisibilityChanged(t){return v(this,null,function*(){let s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(yield this.initializePromise,yield this._acquireLock(-1,()=>v(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(t,s,i){return v(this,null,function*(){let e=[`provider=${encodeURIComponent(s)}`];if(i?.redirectTo&&e.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&e.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){let[n,l]=yield r1(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(l)}`});e.push(r.toString())}if(i?.queryParams){let n=new URLSearchParams(i.queryParams);e.push(n.toString())}return i?.skipBrowserRedirect&&e.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${t}?${e.join("&")}`})}_unenroll(t){return v(this,null,function*(){try{return yield this._useSession(s=>v(this,null,function*(){var i;let{data:e,error:n}=s;return n?{data:null,error:n}:yield M(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(i=e?.session)===null||i===void 0?void 0:i.access_token})}))}catch(s){if(u(s))return{data:null,error:s};throw s}})}_enroll(t){return v(this,null,function*(){try{return yield this._useSession(s=>v(this,null,function*(){var i,e;let{data:n,error:l}=s;if(l)return{data:null,error:l};let r=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:h}=yield M(this.fetch,"POST",`${this.url}/factors`,{body:r,headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});return h?{data:null,error:h}:(t.factorType==="totp"&&(!((e=c?.totp)===null||e===void 0)&&e.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})}))}catch(s){if(u(s))return{data:null,error:s};throw s}})}_verify(t){return v(this,null,function*(){return this._acquireLock(-1,()=>v(this,null,function*(){try{return yield this._useSession(s=>v(this,null,function*(){var i;let{data:e,error:n}=s;if(n)return{data:null,error:n};let{data:l,error:r}=yield M(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(i=e?.session)===null||i===void 0?void 0:i.access_token});return r?{data:null,error:r}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:r})}))}catch(s){if(u(s))return{data:null,error:s};throw s}}))})}_challenge(t){return v(this,null,function*(){return this._acquireLock(-1,()=>v(this,null,function*(){try{return yield this._useSession(s=>v(this,null,function*(){var i;let{data:e,error:n}=s;return n?{data:null,error:n}:yield M(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(i=e?.session)===null||i===void 0?void 0:i.access_token})}))}catch(s){if(u(s))return{data:null,error:s};throw s}}))})}_challengeAndVerify(t){return v(this,null,function*(){let{data:s,error:i}=yield this._challenge({factorId:t.factorId});return i?{data:null,error:i}:yield this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})})}_listFactors(){return v(this,null,function*(){let{data:{user:t},error:s}=yield this.getUser();if(s)return{data:null,error:s};let i=t?.factors||[],e=i.filter(l=>l.factor_type==="totp"&&l.status==="verified"),n=i.filter(l=>l.factor_type==="phone"&&l.status==="verified");return{data:{all:i,totp:e,phone:n},error:null}})}_getAuthenticatorAssuranceLevel(){return v(this,null,function*(){return this._acquireLock(-1,()=>v(this,null,function*(){return yield this._useSession(t=>v(this,null,function*(){var s,i;let{data:{session:e},error:n}=t;if(n)return{data:null,error:n};if(!e)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:l}=x0(e.access_token),r=null;l.aal&&(r=l.aal);let c=r;((i=(s=e.user.factors)===null||s===void 0?void 0:s.filter(d=>d.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(c="aal2");let g=l.amr||[];return{data:{currentLevel:r,nextLevel:c,currentAuthenticationMethods:g},error:null}}))}))})}fetchJwk(i){return v(this,arguments,function*(t,s={keys:[]}){let e=s.keys.find(c=>c.kid===t);if(e)return e;let n=Date.now();if(e=this.jwks.keys.find(c=>c.kid===t),e&&this.jwks_cached_at+k4>n)return e;let{data:l,error:r}=yield M(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(r)throw r;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=n,e=l.keys.find(c=>c.kid===t),!e)?null:e})}getClaims(i){return v(this,arguments,function*(t,s={}){try{let e=t;if(!e){let{data:x,error:f}=yield this.getSession();if(f||!x.session)return{data:null,error:f};e=x.session.access_token}let{header:n,payload:l,signature:r,raw:{header:c,payload:h}}=x0(e);s?.allowExpired||R4(l.exp);let g=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:yield this.fetchJwk(n.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!g){let{error:x}=yield this.getUser(e);if(x)throw x;return{data:{claims:l,header:n,signature:r},error:null}}let d=I4(n.alg),w=yield crypto.subtle.importKey("jwk",g,d,!0,["verify"]);if(!(yield crypto.subtle.verify(d,w,r,H4(`${c}.${h}`))))throw new e1("Invalid JWT signature");return{data:{claims:l,header:n,signature:r},error:null}}catch(e){if(u(e))return{data:null,error:e};throw e}})}}return a.nextInstanceID=0,a})();var W3=t2,o2=W3;var z0=class extends o2{constructor(o){super(o)}};var K3=function(a,o,t,s){function i(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(e,n){function l(h){try{c(s.next(h))}catch(g){n(g)}}function r(h){try{c(s.throw(h))}catch(g){n(g)}}function c(h){h.done?e(h.value):i(h.value).then(l,r)}c((s=s.apply(a,o||[])).next())})},y0=class{constructor(o,t,s){var i,e,n;this.supabaseUrl=o,this.supabaseKey=t;let l=u4(o);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);let r=`sb-${l.hostname.split(".")[0]}-auth-token`,c={db:v4,realtime:w4,auth:Object.assign(Object.assign({},g4),{storageKey:r}),global:h4},h=p4(s??{},c);this.storageKey=(i=h.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(e=h.global.headers)!==null&&e!==void 0?e:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(g,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((n=h.auth)!==null&&n!==void 0?n:{},this.headers,h.global.fetch),this.fetch=d4(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new Q2(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new N1(this.storageUrl.href,this.headers,this.fetch,s?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new _1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(o){return this.rest.from(o)}schema(o){return this.rest.schema(o)}rpc(o,t={},s={}){return this.rest.rpc(o,t,s)}channel(o,t={config:{}}){return this.realtime.channel(o,t)}getChannels(){return this.realtime.getChannels()}removeChannel(o){return this.realtime.removeChannel(o)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var o,t;return K3(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:s}=yield this.auth.getSession();return(t=(o=s.session)===null||o===void 0?void 0:o.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:o,persistSession:t,detectSessionInUrl:s,storage:i,userStorage:e,storageKey:n,flowType:l,lock:r,debug:c},h,g){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new z0({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),h),storageKey:n,autoRefreshToken:o,persistSession:t,detectSessionInUrl:s,storage:i,userStorage:e,flowType:l,lock:r,debug:c,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(w=>w.toLowerCase()==="authorization")})}_initRealtimeClient(o){return new $1(this.realtimeUrl.href,Object.assign(Object.assign({},o),{params:Object.assign({apikey:this.supabaseKey},o?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(o,t,s){(o==="TOKEN_REFRESHED"||o==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:o==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var W4=(a,o,t)=>new y0(a,o,t);function G3(){if(typeof window<"u"||typeof process>"u")return!1;let a=process.version;if(a==null)return!1;let o=a.match(/^v(\d+)\./);return o?parseInt(o[1],10)<=18:!1}G3()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var B1=W4("https://egrdqwwjvopunljggorh.supabase.co","sb_publishable_sjIJmnA0KjABc5H5Of3Ixg_vcddVDdt");var _=[];for(let a=0;a<256;++a)_.push((a+256).toString(16).slice(1));function K4(a,o=0){return(_[a[o+0]]+_[a[o+1]]+_[a[o+2]]+_[a[o+3]]+"-"+_[a[o+4]]+_[a[o+5]]+"-"+_[a[o+6]]+_[a[o+7]]+"-"+_[a[o+8]]+_[a[o+9]]+"-"+_[a[o+10]]+_[a[o+11]]+_[a[o+12]]+_[a[o+13]]+_[a[o+14]]+_[a[o+15]]).toLowerCase()}var s2,J3=new Uint8Array(16);function i2(){if(!s2){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");s2=crypto.getRandomValues.bind(crypto)}return s2(J3)}var Q3=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),a2={randomUUID:Q3};function X3(a,o,t){a=a||{};let s=a.random??a.rng?.()??i2();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,o){if(t=t||0,t<0||t+16>o.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let i=0;i<16;++i)o[t+i]=s[i];return o}return K4(s)}function Y3(a,o,t){return a2.randomUUID&&!o&&!a?a2.randomUUID():X3(a,o,t)}var e2=Y3;var G4=(()=>{let o=class o{constructor(){this.bucket="wallpapers"}uploadFile(s,i,e){return v(this,null,function*(){try{let n=s.name.split(".").pop(),l=`${e2()}.${n}`,r=`${i}/${e}/${l}`,{error:c}=yield B1.storage.from(this.bucket).upload(r,s,{upsert:!0});if(c)return{success:!1,message:c.message};let{data:h}=B1.storage.from(this.bucket).getPublicUrl(r);return{success:!0,url:h.publicUrl,path:r}}catch(n){return{success:!1,message:n.message}}})}listFiles(s,i){return v(this,null,function*(){let e=i?`${s}/${i}`:s,{data:n,error:l}=yield B1.storage.from(this.bucket).list(e,{limit:100});return l||!n?[]:n.map(r=>{let{data:c}=B1.storage.from(this.bucket).getPublicUrl(`${e}/${r.name}`);return{name:`${e}/${r.name}`,url:c.publicUrl}})})}deleteFile(s){return v(this,null,function*(){try{let{error:i}=yield B1.storage.from(this.bucket).remove([s]);return i?{success:!1,message:i.message}:{success:!0}}catch(i){return{success:!1,message:i.message}}})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=n2({token:o,factory:o.\u0275fac,providedIn:"root"});let a=o;return a})();function o6(a,o){if(a&1){let t=A0();O(0,"ion-col",12)(1,"ion-card",13),F(2,"img",14),O(3,"ion-button",15),J("click",function(i){let e=K(t).index;return A1().deleteWallpaper(e),G(i.stopPropagation())}),F(4,"ion-icon",6),T(),O(5,"ion-button",16),J("click",function(){let i=K(t).$implicit,e=A1();return G(e.viewWallpaper(i))}),F(6,"ion-icon",6),T()()()}if(a&2){let t=o.$implicit,s=A1();U(2),j("src",t.url,B0),U(2),j("icon",s.deleteIcon),U(2),j("icon",s.viewIcon)}}function s6(a,o){if(a&1&&F(0,"img",17),a&2){let t=A1();j("src",t.selectedWallpaperUrl,B0)}}var xt=(()=>{let o=class o{constructor(s,i,e,n){this.authService=s,this.supabaseService=i,this.router=e,this.toastCtrl=n,this.wallpapers=[],this.userId=null,this.userEmail=null,this.selectedType="home",this.menuIcon=T2,this.addIcon=V2,this.profileIcon=E2,this.logoutIcon=O2,this.deleteIcon=P2,this.viewIcon=j2,this.selectedWallpaperUrl=null,this.uploading=!1}ngOnInit(){return v(this,null,function*(){let s=this.authService.getCurrentUser();if(!s){this.router.navigate(["/login"]);return}this.userId=s.uid,this.userEmail=s.email,this.userId&&(this.wallpapers=yield this.supabaseService.listFiles(this.userId))})}goToProfile(){this.router.navigate(["/updateprofile"])}onFileSelected(s){return v(this,null,function*(){let i=s.target.files[0];if(!i)return;if(!i.type.startsWith("image/"))return this.showToast("Solo se permiten im\xE1genes");if(i.size>5*1024*1024)return this.showToast("Archivo > 5MB");if(this.uploading)return this.showToast("Subida en progreso");if(!this.userId)return this.showToast("Usuario no autenticado");this.uploading=!0;let e=yield this.supabaseService.uploadFile(i,this.userId,this.selectedType);this.uploading=!1,e.success&&e.url?(this.wallpapers.unshift({name:e.path,url:e.url}),this.showToast("Wallpaper subido")):this.showToast("Error subiendo: "+e.message)})}viewWallpaper(s){this.selectedWallpaperUrl=s.url,this.modal.present()}closeModal(){this.modal.dismiss(),this.selectedWallpaperUrl=null}deleteWallpaper(s){return v(this,null,function*(){if(!this.userId)return this.showToast("Usuario no autenticado");let i=this.wallpapers[s],e=yield this.supabaseService.deleteFile(i.name);e.success?(this.wallpapers.splice(s,1),this.showToast("Wallpaper eliminado")):this.showToast("Error al eliminar: "+e.message)})}logout(){return v(this,null,function*(){(yield this.authService.logout()).success?this.router.navigate(["/login"]):this.showToast("Error al cerrar sesi\xF3n")})}showToast(s){return v(this,null,function*(){(yield this.toastCtrl.create({message:s,duration:2e3,position:"bottom"})).present()})}};o.\u0275fac=function(i){return new(i||o)(L1(S2),L1(G4),L1(p2),L1(A2))},o.\u0275cmp=l2({type:o,selectors:[["app-home"]],viewQuery:function(i,e){if(i&1&&r2(S0,5),i&2){let n;c2(n=h2())&&(e.modal=n.first)}},decls:24,vars:7,consts:[["fileInput",""],["modal",""],[1,"ion-padding",3,"fullscreen"],[1,"home-title"],["size","6",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"icon"],["side","top"],[3,"click"],["type","file","accept","image/*","hidden","",3,"change"],["fill","clear","color","danger",3,"click"],["class","full-wallpaper",3,"src",4,"ngIf"],["size","6"],[1,"wallpaper-card"],["alt","wallpaper",3,"src"],["fill","clear","color","danger",1,"delete-btn",3,"click"],["fill","clear","color","light",1,"view-btn",3,"click"],[1,"full-wallpaper",3,"src"]],template:function(i,e){if(i&1){let n=A0();O(0,"ion-content",2)(1,"div",3),C0(2," Mywallpapers "),T(),O(3,"ion-grid")(4,"ion-row"),L0(5,o6,7,3,"ion-col",4),T()(),O(6,"ion-fab",5)(7,"ion-fab-button"),F(8,"ion-icon",6),T(),O(9,"ion-fab-list",7)(10,"ion-fab-button",8),J("click",function(){K(n);let r=v2(17);return G(r.click())}),F(11,"ion-icon",6),T(),O(12,"ion-fab-button",8),J("click",function(){return K(n),G(e.goToProfile())}),F(13,"ion-icon",6),T(),O(14,"ion-fab-button",8),J("click",function(){return K(n),G(e.logout())}),F(15,"ion-icon",6),T()()(),O(16,"input",9,0),J("change",function(r){return K(n),G(e.onFileSelected(r))}),T(),O(18,"ion-modal",null,1)(20,"ion-content")(21,"ion-button",10),J("click",function(){return K(n),G(e.closeModal())}),C0(22,"Cerrar"),T(),L0(23,s6,1,1,"img",11),T()()()}i&2&&(j("fullscreen",!0),U(5),j("ngForOf",e.wallpapers),U(3),j("icon",e.menuIcon),U(3),j("icon",e.addIcon),U(2),j("icon",e.profileIcon),U(2),j("icon",e.logoutIcon),U(8),j("ngIf",e.selectedWallpaperUrl))},dependencies:[d2,g2,w2,u2,M2,m2,x2,B2,L2,f2,C2,k2,z2,y2,S0],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: linear-gradient(-45deg, #1f1c2c, #928dab, #1f1c2c, #928dab);background-size:400% 400%;animation:_ngcontent-%COMP%_gradientMove 12s ease infinite}@keyframes _ngcontent-%COMP%_gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.home-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#fff;text-align:center;margin-bottom:16px;letter-spacing:1px}.wallpaper-card[_ngcontent-%COMP%]{position:relative;border-radius:16px;background:#ffffff0d;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);box-shadow:0 8px 20px #0000004d;overflow:hidden;transition:transform .3s ease,box-shadow .3s ease;height:200px;margin-bottom:16px;border:1px solid rgba(255,255,255,.1)}.wallpaper-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 12px 28px #0006}.wallpaper-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.delete-btn[_ngcontent-%COMP%], .view-btn[_ngcontent-%COMP%]{position:absolute;top:6px;z-index:10;--padding-start: 0;--padding-end: 0}.delete-btn[_ngcontent-%COMP%]{right:6px}.view-btn[_ngcontent-%COMP%]{left:6px}ion-fab-button[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #00f2fe, #4facfe);--background-activated: #2193b0;border-radius:14px;transition:transform .2s ease-in-out,box-shadow .2s ease}ion-fab-button[_ngcontent-%COMP%]:hover{transform:scale(1.1);box-shadow:0 6px 18px #00f2fe80}']});let a=o;return a})();export{xt as HomePage};
